<html><head><script src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=default'></script><link rel='stylesheet' type='text/css' href='https://www.yaas.io/globalresources/v3/css/global.min.css' media='screen, projection, print'><link rel='stylesheet' href='https://devportal.yaas.io/styles/devportal-yaas.css'></head><body onload='prettyPrint()'><a name='Top'/><h2>YaaS Bites Source Code</h2><h3>Content</h3><a href='#essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Greeting.java'>essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Greeting.java</a><br><a href='#essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/GreetingController.java'>essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/GreetingController.java</a><br><a href='#essentials/yaasbite100/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbite100/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br><a href='#essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Tip.java'>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Tip.java</a><br><a href='#essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipController.java'>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipController.java</a><br><a href='#essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipsRepo.java'>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipsRepo.java</a><br><a href='#essentials/yaasbite200/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbite200/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br><a href='#essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Tip.java'>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Tip.java</a><br><a href='#essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipController.java'>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipController.java</a><br><a href='#essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipsRepo.java'>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipsRepo.java</a><br><a href='#essentials/yaasbite300/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbite300/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br><a href='#essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/InsufficientScopeException.java'>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/InsufficientScopeException.java</a><br><a href='#essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/NoTenantException.java'>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/NoTenantException.java</a><br><a href='#essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Tip.java'>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Tip.java</a><br><a href='#essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipController.java'>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipController.java</a><br><a href='#essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipsRepo.java'>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipsRepo.java</a><br><a href='#essentials/yaasbite400/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbite400/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br><a href='#essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Application.java'>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Application.java</a><br><a href='#essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Tip.java'>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Tip.java</a><br><a href='#essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipController.java'>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipController.java</a><br><a href='#essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipsRepo.java'>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipsRepo.java</a><br><a href='#essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java'>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java</a><br><a href='#essentials/yaasbite500/src/test/java/com/hybris/yaaspathl/SpringTest.java'>essentials/yaasbite500/src/test/java/com/hybris/yaaspathl/SpringTest.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Application.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Application.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/InsufficientScopeException.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/InsufficientScopeException.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/NoTenantException.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/NoTenantException.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Tip.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Tip.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipController.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipController.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipsRepo.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipsRepo.java</a><br><a href='#essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java'>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java</a><br><a href='#essentials/yaasbite600/src/test/java/com/hybris/yaaspathl/SpringTest.java'>essentials/yaasbite600/src/test/java/com/hybris/yaaspathl/SpringTest.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/CallingYaaSServiceException.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/CallingYaaSServiceException.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/InsufficientScopesException.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/InsufficientScopesException.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/NoTenantException.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/NoTenantException.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/StringUtils.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/StringUtils.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/DocuServiceWrapper.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/DocuServiceWrapper.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/OAuthWrapper.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/OAuthWrapper.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/TipsDocuRepo.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/TipsDocuRepo.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Tip.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Tip.java</a><br><a href='#essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/TipController.java'>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/TipController.java</a><br><a href='#essentials/yaasbite800/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbite800/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br><a href='#essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipController.java'>essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipController.java</a><br><a href='#essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipService.java'>essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipService.java</a><br><a href='#essentials/yaasbite900/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbite900/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br><a href='#essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/Application.java'>essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/Application.java</a><br><a href='#essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubClient.java'>essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubClient.java</a><br><a href='#essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubJsonOutput.java'>essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubJsonOutput.java</a><br><a href='#essentials/yaasbitepubsub/src/test/java/com/hybris/yaas/bites/SanityTest.java'>essentials/yaasbitepubsub/src/test/java/com/hybris/yaas/bites/SanityTest.java</a><br>File: <b id='essentials/yaasbite100/pom.xml'/>essentials/yaasbite100/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;

	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite1&lt;/artifactId&gt;
	&lt;name&gt;yaasbite1&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.6.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;
	
	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
   </pre></code></pre>File: <b id='essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {  // See Spring Boot @ https://spring.io/guides/gs/spring-boot/
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Greeting.java'/>essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/Greeting.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

public class Greeting {

	private long id;
    private String content;
 
    public Greeting(){
    }
    
    public Greeting(long id, String content) {
        this.id = id;
        this.content = content;
    }

    public long getId() {
        return id;
    }

    public String getContent() {
        return content;
    }
    
	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		Greeting other = (Greeting) obj;
		if (content == null) {
			if (other.content != null)
				return false;
		} else if (!content.equals(other.content))
			return false;
		if (id != other.id)
			return false;
		return true;
	}

}

</code></pre>File: <b id='essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/GreetingController.java'/>essentials/yaasbite100/src/main/java/com/hybris/yaas/bites/GreetingController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.concurrent.atomic.AtomicLong;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class GreetingController {

    private final String TEMPLATE = "Greetings from Bayern, Most Honorable %s!";
    private final Logger LOG = LoggerFactory.getLogger(GreetingController.class);
    private final AtomicLong counter = new AtomicLong();
    
    @RequestMapping( "/greeting" )
    public ResponseEntity<Greeting> greetings( @RequestParam( value="name", defaultValue="User") String name) {
    	LOG.debug("======= In /greetings with name: "+ name );    	
    	return new ResponseEntity<Greeting>(new Greeting(counter.incrementAndGet(), 
    			String.format(TEMPLATE, name)), HttpStatus.OK); 
    }

}
</code></pre>File: <b id='essentials/yaasbite100/src/main/webapp/index.html'/>essentials/yaasbite100/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;body&gt;
		&lt;h2&gt;YaaSBites1&lt;/h2&gt;
		A tiny web-service from YaaSBite1 @ &lt;a href="https://yaasbiteindex.cfapps.us10.hana.ondemand.com"&gt;YaaSBites&lt;/a&gt;&lt;br&gt;&lt;br&gt;
		Open this page in a Chrome Browser, and open Chrome's Developer Tools from inside Chrom: (View | Developer | DeveloperTools), then&lt;br&gt;
		watch and understand the REST traffic that occurs when you visit
		&lt;a href="/greeting"&gt;/greeting&lt;/a&gt; and 
		&lt;a href="/greeting?name=bod"&gt;/greeting?name=bod&lt;/a&gt;&lt;br&gt;&lt;br&gt;
		
		&lt;img src="images/YB1CDT.png" width=300/&gt;&lt;br&gt; 	&lt;img src="images/bite1.png" width=300&gt;		
&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite100/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite100/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite100/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbite100/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.assertEquals;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.TestRestTemplate;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")
public class SanityTest {

	private final String HOMEPAGE = "http://localhost:8080/greeting";
	
	@Test(timeout = 60000) 
	public void siteIsAwakeAndWorking() throws Exception {	
		
		final TestRestTemplate restTemplate = new TestRestTemplate();
        Greeting greeting1 = restTemplate.getForObject(HOMEPAGE, Greeting.class);
        assertEquals(greeting1, new Greeting( 1, "Greetings from Bayern, Most Honorable User!"));      
               
        Greeting greeting2  = restTemplate.getForObject(HOMEPAGE+"?name=Bod", Greeting.class);
        assertEquals(greeting2, new Greeting( 2, "Greetings from Bayern, Most Honorable Bod!"));   
 
	}

}
</code></pre>File: <b id='essentials/yaasbite200/pom.xml'/>essentials/yaasbite200/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	
	&lt;!-- Adapted from: mvn archetype:generate -DgroupId=com.hybris.bites.yaas 
		-DartifactId=yaasbite1 -DarchetypeArtifactId=maven-archetype-webapp -DinteractiveMode=false --&gt;
	
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite2&lt;/artifactId&gt;
	&lt;name&gt;yaasbite2&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
		&lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        
		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
		&lt;/dependency&gt;
		
		 &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;
	
	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
   </pre></code></pre>File: <b id='essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Tip.java'/>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/Tip.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Tip {

	@Id
    @GeneratedValue(strategy = GenerationType.AUTO)
	private long id;
    
    private String tip;
  
	public Tip() {
	}

	public Tip(long id, String tip) {
		this.id = id;
		this.tip = stripTip(tip);
	}

	public long getId() {
		return id;
	}

	public void setId(long id) {
		this.id = id;
	}

	public void setTip(String tip) {
		this.tip = stripTip(tip);
	}

	public String getTip() {
		return tip;
	}
	
	public String toString(){
		return "Tip[ Id: "+id +" Tip: "+ tip +"]\n";
	}
	private String stripTip(String tip){
		return tip==null ? null : tip.substring(0, Math.min(tip.length(), 200));
	}


	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		Tip other = (Tip) obj;
		if (id != other.id)
			return false;
		if (tip == null) {
			if (other.tip != null)
				return false;
		} else if (!tip.equals(other.tip))
			return false;
		return true;
	}
}
</code></pre>File: <b id='essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipController.java'/>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;
		
@RestController
public class TipController {
    
	private final Logger LOG = LoggerFactory.getLogger(TipController.class);

    @Autowired
    private TipsRepo repo;
    
    @RequestMapping( value="/ping", method=RequestMethod.GET )
    public ResponseEntity<String> ping(  ) {
    	LOG.debug("-> In GET /ping");
    	return new ResponseEntity<String>( "Pong", HttpStatus.OK); 
    }
     
    @CrossOrigin() 
    @RequestMapping( value="/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTips( ) {
    	LOG.debug("-> In GET /tips");
    	return new ResponseEntity<List<Tip>>( iterableToList(repo.findAll()), HttpStatus.OK); 
    }
    
    @RequestMapping( value="/tips", method=RequestMethod.POST )
    public ResponseEntity<Void> postTip(  @RequestBody Tip t, UriComponentsBuilder ucBuilder ) {  	
    	LOG.debug("-> In POST /tips");
    	repo.save( t );
    	HttpHeaders headers = new HttpHeaders();
    	headers.setLocation(ucBuilder.path("/tips/{id}").buildAndExpand(t.getId()).toUri());
		return new ResponseEntity<Void>(headers, HttpStatus.CREATED);         
    }
    
    @RequestMapping( value="/tips/{id}", method=RequestMethod.PUT )
    public ResponseEntity<String> putTip(  @PathVariable Long id, @RequestBody Tip t ) {
    	LOG.debug("-> In PUT /tips ");

    	synchronized(repo){
    		if (repo.exists(id)){
    			Tip oldTip = repo.findOne(id);
    			oldTip.setTip(t.getTip());
    			repo.save(oldTip);
    			return new ResponseEntity<String>( HttpStatus.OK); 
    		}
    	}  	
    	return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{\"message\":\"Tip "+id+" not found\"}");
    }
    
    @RequestMapping( value="/tips/{id}", method=RequestMethod.DELETE )
    public ResponseEntity<String> deleteTip( @PathVariable Long id ) {
    	LOG.debug("-> In DELETE /tips");
    	synchronized(repo){
    		if (repo.exists(id)){
    			repo.delete(id);
    			return new ResponseEntity<String>(HttpStatus.NO_CONTENT); // If not found, could return HttpStatus.NOT_FOUND
    		}
    	}  	
    	return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{\"message\":\"Tip "+id+" not found\"}");
    }
   
	private static <T> List<T> iterableToList(Iterable<T> iterable) {
	  List<T> list = new ArrayList<>();
	  iterable.forEach(list::add);
	  return list;
	}
	
}
</code></pre>File: <b id='essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipsRepo.java'/>essentials/yaasbite200/src/main/java/com/hybris/yaas/bites/TipsRepo.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.data.repository.CrudRepository;

public interface TipsRepo extends CrudRepository<Tip, Long> {
	
	
}
</code></pre>File: <b id='essentials/yaasbite200/src/main/webapp/index.html'/>essentials/yaasbite200/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;
&lt;script&gt;
	var app = angular.module('tipsApp', ['restangular']);

	app.config(function(RestangularProvider) {
	});

	app.controller('tipsController', function($scope, Restangular) {

		$scope.onOpen = function( ) {
			var location = window.location.href.toString().replace("#", "").replace("/index.html", "");
			if(location.charAt(location.length - 1)=='/')
				location = location.slice(0,-1);
			$scope.windowLocation = location;
		}

		$scope.clearFeedback=function(){
			$scope.responseData=null
			$scope.errorMessage=null
		}

		$scope.ping = function(){
			$scope.clearFeedback()
			Restangular.one("ping").get().then(
				function(data) {
					$scope.responseData = data;
				},
				function(response) {
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

		$scope.getTips = function(){
			$scope.clearFeedback();
			Restangular.all("tips").getList().then(
				function(data) {
					$scope.responseData = Restangular.stripRestangular(data)
				},
	    	    function(response){
	    	    	$scope.errorMessage=response.status + ' '+response.data;
	    	    }
			);
		}

	    $scope.postTip = function(){
	    	$scope.clearFeedback();
	    	if(!$scope.validateText(true))
    			return;
    		var json = { 'tip': ''+$scope.tipText }
    		Restangular.all("tips").post(json).then(
    			function(data) {
		    		$scope.getTips()
	    	    },
	    	    function(response){
	    	    	$scope.errorMessage=response.status + ' '+response.data;
	    	    }
	    	);
		}

	    $scope.putTip = function(){
	    	$scope.clearFeedback();
	    	if( !$scope.validateId(true) || !$scope.validateText(false) )
    			return;
	    	var json = { 'tip': ''+$scope.tipText }
	    	Restangular.one("tips/"+$scope.tipId).customPUT(json).then(
	    		function(data) {
    				$scope.getTips()
        		},
	    	    function(response){
	    	    	$scope.errorMessage=response.status + ' '+response.data.message;
	    	    }
        	);
		}

	    $scope.deleteTip = function(){
	    	$scope.clearFeedback();
	    	if(!$scope.validateId(true))
    			return;
	    	Restangular.one("tips/"+$scope.tipId).remove().then(
	    		function(data) {
	    			$scope.getTips()
	        	},
	    	    function(response){
	    	    	$scope.errorMessage=response.status + ' '+response.data.message;
	    	    }
	        );
		}

		$scope.validateText = function(clearMsg){
			if(clearMsg)
				$scope.errorMessage = ""
			if ($scope.tipText)
				return true;
			$scope.errorMessage = "You need to add a text for the tip";
			return false;
		}

		$scope.validateId = function( clearMsg){
			if(clearMsg)
				$scope.errorMessage = ""
			if ($scope.tipId && $scope.tipId &gt;-1)
				return true;
			$scope.errorMessage = "The ID is invalid - select an ID from the list of Tips you have created";
			return false;
		}
	});

&lt;/script&gt;

&lt;body ng-app="tipsApp" ng-controller="tipsController"   ng-init="onOpen()"&gt;

	&lt;h2&gt;YaaS Bite: Top Tips&lt;/h2&gt;	
	A client-front-end to make REST calls to a Tips Service.&lt;br&gt;&lt;br&gt;


	Ping the service @ &lt;a href="#" ng-click="ping()"&gt; {{windowLocation}}/ping&lt;/a&gt;&lt;br&gt;
	List the tips: call &lt;a href="#" ng-click="getTips()"&gt;GET {{windowLocation}}/tips&lt;/a&gt;&lt;br&gt;
	Add a tip: call &lt;a href="#" ng-click="postTip()"&gt;POST {{windowLocation}}/tips&lt;/a&gt; with JSON body: { 'tip': '&lt;input name=tipText ng-model="tipText" value="Don't eat fireworks"/&gt;' } E.g. "Don't eat fireworks"&lt;br&gt;
	Update an existing tip: call &lt;a href="#" ng-click="putTip()"&gt; PUT {{windowLocation}}/tips/&lt;/a&gt; with index: &lt;input name=tipId ng-model="tipId" type="number" /&gt; and JSON body { 'tip': '&lt;input name=tipText ng-model="tipText" value="Don't eat fireworks"/&gt;' }&lt;br&gt;
	Delete a tip: call &lt;a href="#" ng-click="deleteTip()"&gt;DELETE {{windowLocation}}/tips&lt;/a&gt; with index &lt;input name=tipId ng-model="tipId"  type="number" /&gt; &lt;br&gt;

	&lt;p style="color:red" ng-show="errorMessage"&gt;Woops: {{errorMessage|json}}&lt;/p&gt;
	&lt;p style="color:green" ng-show="responseData!=null"&gt;Response: {{responseData|json}}&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite200/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite200/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite200/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbite200/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.assertEquals;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.TestRestTemplate;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.http.HttpEntity;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")
public class SanityTest {

	private final String HOMEPAGE = "http://localhost:8080/tips";
	
	@Test(timeout = 60000) 
	public void siteIsAwakeAndWorking() throws Exception {		
	
		final TestRestTemplate restTemplate = new TestRestTemplate();
        Tip[] tips  = restTemplate.getForObject(HOMEPAGE, Tip[].class);
        assertEquals( 0, tips.length);      
		
		Tip newTip = new Tip(1, "Hello World!");
	    HttpEntity<Tip> newTipAsEntity = new HttpEntity<Tip>( newTip );
        restTemplate.postForEntity( HOMEPAGE, newTipAsEntity, Tip.class);    
        tips  = restTemplate.getForObject(HOMEPAGE, Tip[].class);
        assertEquals( newTip, tips[0]);        

        Tip newTip2 = new Tip(2, "Bonjour!");
	    newTipAsEntity = new HttpEntity<Tip>( newTip2 );
        restTemplate.postForEntity( HOMEPAGE, newTipAsEntity, Tip.class);    
        tips  = restTemplate.getForObject(HOMEPAGE, Tip[].class);
        assertEquals( newTip, tips[0]);        
        assertEquals( newTip2, tips[1]);        
        
        Tip updatedTip = new Tip(1, "Hello There World!");
        restTemplate.put( HOMEPAGE+"/1", updatedTip);     
        tips  = restTemplate.getForObject(HOMEPAGE, Tip[].class);
        assertEquals( updatedTip, tips[0]);        
        
        restTemplate.delete( HOMEPAGE+"/1" );     
        tips  = restTemplate.getForObject(HOMEPAGE, Tip[].class);
        assertEquals( 1, tips.length);  

        restTemplate.delete( HOMEPAGE+"/2" );     
        tips  = restTemplate.getForObject(HOMEPAGE, Tip[].class);
        assertEquals( 0, tips.length);  
}

}
</code></pre>File: <b id='essentials/yaasbite300/pom.xml'/>essentials/yaasbite300/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite3&lt;/artifactId&gt;
	&lt;name&gt;yaasbite3&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.sap.cloud.yaas.raml-parser&lt;/groupId&gt;
			&lt;artifactId&gt;raml-parser&lt;/artifactId&gt;
			&lt;version&gt;1.0.2&lt;/version&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
					&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;guru.nidi.raml&lt;/groupId&gt;
			&lt;artifactId&gt;raml-tester&lt;/artifactId&gt;
			&lt;version&gt;0.8.8&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
			&lt;version&gt;1.7.1&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
  



    

 </pre></code></pre>File: <b id='essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Tip.java'/>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/Tip.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Tip {

	@Id
    @GeneratedValue(strategy = GenerationType.AUTO)
	private long id;
    
    private String tenant; 
  
	private String tip;
  
	public Tip() {
	}

	public Tip(long id, String tip, String tenant) {
		this.id = id;
		this.tip = stripTip(tip);
		this.tenant = tenant;
	}

	public long getId() {
		return id;
	}

	public void setId(long id) {
		this.id = id;
	}

	public void setTip(String tip) {
		this.tip = stripTip(tip);
	}

	public String getTip() {
		return tip;
	}
	
	public String getTenant() {
		return tenant;
	}

	public void setTenant(String tenant) {
		this.tenant = tenant;
	}
	public String toString(){
		return "Tip[ Id: "+id +" Tip: "+ tip +" Tenant: "+tenant+"]\n";
	}
	private String stripTip(String tip){		
		return tip==null ? null : tip.substring(0, Math.min(tip.length(), 200));
	}
	

	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		Tip other = (Tip) obj;
		if (id != other.id)
			return false;
		if (tenant == null) {
			if (other.tenant != null)
				return false;
		} else if (!tenant.equals(other.tenant))
			return false;
		if (tip == null) {
			if (other.tip != null)
				return false;
		} else if (!tip.equals(other.tip))
			return false;
		return true;
	}
}
</code></pre>File: <b id='essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipController.java'/>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;
import org.springframework.http.HttpHeaders;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
		
@RestController
public class TipController {
    
	private final Logger LOG = LoggerFactory.getLogger(TipController.class);

    @Autowired
    private TipsRepo repo;

    @CrossOrigin()
    @RequestMapping( value="/ping", method=RequestMethod.GET )
    public ResponseEntity<String> ping(  ) {
    	LOG.debug("-> In GET /ping");
    	return new ResponseEntity<String>( "Pong", HttpStatus.OK); 
    }
    
    @RequestMapping( value="/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTipsForAllTenants( ) {
    	LOG.debug("-> In GET /tips ");
    	return new ResponseEntity<List<Tip>>( iterableToList( repo.findAll() ), HttpStatus.OK); 
    } 
    
    @RequestMapping( value="/{tenant}/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTipsForATenant( @PathVariable String tenant ) {
    	LOG.debug("-> In GET tenant/tips "+tenant);
    	return new ResponseEntity<List<Tip>>( repo.findByTenant( tenant ), HttpStatus.OK); 
    }
    
    @RequestMapping( value="/{tenant}/tips", method=RequestMethod.POST )
    public ResponseEntity<Void> postTip( @PathVariable String tenant, @RequestBody Tip t, UriComponentsBuilder ucBuilder ) {  	
    	LOG.debug("-> In POST tenant/tips "+tenant);
    	t.setTenant(tenant);
    	repo.save( t );
    	HttpHeaders newHeaders = new HttpHeaders();
    	newHeaders.setLocation(ucBuilder.path("/tips/{id}").buildAndExpand(t.getId()).toUri());
		return new ResponseEntity<Void>(newHeaders, HttpStatus.CREATED);         
    }
    
    @RequestMapping( value="/{tenant}/tips/{id}", method=RequestMethod.PUT )
    public ResponseEntity<String> putTip( @PathVariable String tenant, @PathVariable Long id, @RequestBody Tip t ) {
    	LOG.debug("-> In PUT tenant/tips "+tenant);
    	synchronized(repo){
    		if (repo.exists(id)){
    			Tip oldTip = repo.findOne(id);
				if (oldTip.getTenant().equals(tenant)){
					oldTip.setTip(t.getTip());
    				repo.save(oldTip);
    				return new ResponseEntity<String>( HttpStatus.OK); 
				}				
    		}
    	}  	
    	return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{\"message\":\"Tip "+id+" not found\"}");
    }
    
    @RequestMapping( value="/{tenant}/tips/{id}", method=RequestMethod.DELETE )
    public ResponseEntity<String> deleteTip( @PathVariable String tenant, @PathVariable Long id ) {
    	LOG.debug("-> In DELETE tenant/tips "+tenant);
    	
    	synchronized(repo){
			Tip tip = repo.findOne(id);
			if (tip!=null){
				if (tip.getTenant().equals(tenant))
					repo.delete(id);
				return new ResponseEntity<String>(HttpStatus.NO_CONTENT); // If not found, could return HttpStatus.NOT_FOUND
			}
		}  	
    	return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{\"message\":\"Tip "+id+" not found\"}");
    }
   
	private static <T> List<T> iterableToList(Iterable<T> iterable) {
	  List<T> list = new ArrayList<>();
	  iterable.forEach(list::add);
	  return list;
	}
	
}
</code></pre>File: <b id='essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipsRepo.java'/>essentials/yaasbite300/src/main/java/com/hybris/yaas/bites/TipsRepo.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.List;

import org.springframework.data.repository.CrudRepository;

public interface TipsRepo extends CrudRepository<Tip, Long> {
	List<Tip> findByTenant(String tenant);
}
</code></pre>File: <b id='essentials/yaasbite300/src/main/webapp/index.html'/>essentials/yaasbite300/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;
&lt;script&gt;
	var app = angular.module('tipsApp', ['restangular']);

	app.config(function(RestangularProvider) {
		var location = window.location.href.toString().replace("#", "").replace("/index.html", "");
		RestangularProvider.setBaseUrl(location);
	});

	app.controller('tipsController', function($scope, Restangular, $http ) {

		$scope.onOpen = function( ) {
			var location = window.location.href.toString().replace("#", "").replace("/index.html", "");
			if(location.charAt(location.length - 1)=='/')
				location = location.slice(0,-1);
			$scope.windowLocation = location;
			$scope.tenantName="SpecifyATenant"
		}

		$scope.getReadyToCall = function( restangular, useTenant ){
			$scope.responseData=null
			$scope.errorMessage=null

			var location = $scope.windowLocation
			if (useTenant)
				restangular.setBaseUrl(location+"/"+$scope.tenantName);
			else
				restangular.setBaseUrl(location);
		}

		$scope.ping = function(){
			$scope.getReadyToCall(Restangular, false)
			Restangular.one("ping").get().then(
				function(data) {
					$scope.responseData = data;
				},
				function(response) {
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

		$scope.getAllTips = function(){
			$scope.getReadyToCall(Restangular, false)
			Restangular.all("tips").getList().then(
				function(data) {
					$scope.responseData = Restangular.stripRestangular(data)
				},
				function(response) {
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

		$scope.getTips = function(){
			$scope.getReadyToCall(Restangular, true)
			if(!$scope.validateTenantName(false))
    			return;
			Restangular.all("tips").getList().then(
				function(data) {
					$scope.responseData = Restangular.stripRestangular(data)
				},
				function(response) {
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

	    $scope.postTip = function(){
	    	$scope.getReadyToCall(Restangular, true)
			if(!$scope.validateTenantName(false))
    			return ;
	    	if(!$scope.validateText(true))
    			return;

    		var json = { 'tip': ''+$scope.tipText }
    		Restangular.all("tips").post(json).then(
    			function(data) {
	    			$scope.getTips()
    	    	},
				function(response) {
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

	    $scope.putTip = function(){
	    	$scope.getReadyToCall(Restangular, true)
	    	if( !$scope.validateTenantName(false) || !$scope.validateId(false) || !$scope.validateText(false) )
    			return;
	    	var json = { 'tip': ''+$scope.tipText }
	    	Restangular.one("tips/"+$scope.tipId).customPUT(json).then(
	    		function(data) {
    				$scope.getTips()
        		},
				function(response) {
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

	    $scope.deleteTip = function(){
	    	$scope.getReadyToCall(Restangular, true)
	    	if(!$scope.validateTenantName(false) || !$scope.validateId(false))
    			return;
	    	Restangular.one("tips/"+$scope.tipId).remove().then(
	    		function(data) {
	    			$scope.getTips()
	        	},
				function(response) {
	        		console.log('In deleteTipb'+response)
					$scope.errorMessage = response.status + ' '+response.data.message;
			  	}
			);
		}

		$scope.validateText = function(clearMsg){
			if(clearMsg)
				$scope.errorMessage = ""
			if ($scope.tipText)
				return true;
			$scope.errorMessage = "Woops, please provide a Tip text";
			return false;
		}

		$scope.validateId = function( clearMsg){
			if(clearMsg)
				$scope.errorMessage = ""
			if ($scope.tipId && $scope.tipId &gt;-1)
				return true;
			$scope.errorMessage = "Woops, please provide an ID ";
			return false;
		}

		$scope.validateTenantName = function( clearMsg){
			if(clearMsg)
				$scope.errorMessage = ""
			if ($scope.tenantName)
				return true;
			$scope.errorMessage = "Woops, please provide a name for the Tenant field, eg. Adidas, or Nike, ..";
			return false;
		}

	});
&lt;/script&gt;

&lt;body ng-app="tipsApp" ng-controller="tipsController" ng-init="onOpen()"&gt;
	&lt;h2&gt;YaaS Bite: Top Tips separated by Tenant&lt;/h2&gt;	


	A client-front-end to make REST calls to the Multi-tenant Tips Service.&lt;br&gt;

	Ping the service @ &lt;a href="#" ng-click="ping()"&gt; {{windowLocation}}/ping&lt;/a&gt;&lt;br&gt;
	Tenant name:&lt;input name=tenantName ng-model="tenantName" /&gt;&lt;br&gt;
	List the tips: call &lt;a href="#" ng-click="getTips()"&gt;GET {{windowLocation}}/{{tenantName}}/tips&lt;/a&gt;&lt;br&gt;
	Add a tip: call &lt;a href="#" ng-click="postTip()"&gt;POST {{windowLocation}}/{{tenantName}}/tips&lt;/a&gt; with JSON body: { 'tip': '&lt;input name=tipText ng-model="tipText" value="Don't eat fireworks"/&gt;' } E.g. "Don't eat fireworks"&lt;br&gt;
	Update an existing tip: call &lt;a href="#" ng-click="putTip()"&gt; PUT {{windowLocation}}/{{tenantName}}/tips/&lt;/a&gt; with index: &lt;input name=tipId ng-model="tipId" type="number" /&gt; and JSON body { 'tip': '&lt;input name=tipText ng-model="tipText" value="Don't eat fireworks"/&gt;' }&lt;br&gt;
	Delete a tip: call &lt;a href="#" ng-click="deleteTip()"&gt;DELETE {{windowLocation}}/{{tenantName}}/tips&lt;/a&gt; with index &lt;input name=tipId ng-model="tipId"  type="number" /&gt; &lt;br&gt;

	Get all tips from all tenants: &lt;/b&gt;&lt;a href="#" ng-click="getAllTips()"&gt;Call GET {{windowLocation}}/tips&lt;/a&gt;&lt;br&gt;


	&lt;p style="color:red" ng-show="errorMessage"&gt;Woops: {{errorMessage|json}}&lt;/p&gt;
	&lt;p style="color:green" ng-show="responseData!=null"&gt;Response: {{responseData|json}}&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite300/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite300/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite300/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbite300/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.assertEquals;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.TestRestTemplate;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.http.HttpEntity;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")
public class SanityTest {

	private final String TENANT1="Adidas";
	private final String TENANT2="NIke";	
	private final String TENANT1ENDPOINT = "http://localhost:8080/"+TENANT1+"/tips";
	private final String TENANT2ENDPOINT = "http://localhost:8080/"+TENANT2+"/tips";
	
	@Test(timeout = 60000) 
	public void siteIsAwakeAndWorking() throws Exception {		
	
		final TestRestTemplate restTemplate = new TestRestTemplate();
        Tip[] tips  = restTemplate.getForObject(TENANT1ENDPOINT, Tip[].class);
        assertEquals( 0, tips.length);     
        
		Tip newTip1 = new Tip(1, "Hello World!",TENANT1);
	    HttpEntity<Tip> newTipAsEntity = new HttpEntity<Tip>( newTip1 );
        restTemplate.postForEntity( TENANT1ENDPOINT, newTipAsEntity, Tip.class);    
        tips  = restTemplate.getForObject(TENANT1ENDPOINT, Tip[].class);
        
        assertEquals( 1, tips.length);
        assertEquals( newTip1, tips[0]);        

        Tip newTip2 = new Tip(2, "Bonjour!",TENANT1);
	    newTipAsEntity = new HttpEntity<Tip>( newTip2 );
        restTemplate.postForEntity( TENANT1ENDPOINT, newTipAsEntity, Tip.class);    
        tips  = restTemplate.getForObject(TENANT1ENDPOINT, Tip[].class);
        assertEquals( 2, tips.length);
        assertEquals( newTip1, tips[0]);        
        assertEquals( newTip2, tips[1]);        
           
   		Tip newTip3= new Tip(3, "Hello World!",TENANT2);
   	    newTipAsEntity = new HttpEntity<Tip>( newTip3 );
        restTemplate.postForEntity( TENANT2ENDPOINT, newTipAsEntity, Tip.class);    
        tips  = restTemplate.getForObject(TENANT2ENDPOINT, Tip[].class);
        assertEquals( 1, tips.length);
        assertEquals( newTip3, tips[0]);       
         
        Tip updatedTip = new Tip(1, "Hello There World!","Adidas");
        restTemplate.put( TENANT1ENDPOINT+"/1", updatedTip);     
        tips  = restTemplate.getForObject(TENANT1ENDPOINT, Tip[].class);
        assertEquals( updatedTip, tips[0]);        
        
        restTemplate.delete( TENANT1ENDPOINT+"/1" );     
        tips  = restTemplate.getForObject(TENANT1ENDPOINT, Tip[].class);
        assertEquals( 1, tips.length);  

        restTemplate.delete( TENANT1ENDPOINT+"/2" );     
        tips  = restTemplate.getForObject(TENANT1ENDPOINT, Tip[].class);
        assertEquals( 0, tips.length);  
	}

}
</code></pre>File: <b id='essentials/yaasbite400/pom.xml'/>essentials/yaasbite400/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite4&lt;/artifactId&gt;
	&lt;name&gt;yaasbite4&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.sap.cloud.yaas.raml-parser&lt;/groupId&gt;
			&lt;artifactId&gt;raml-parser&lt;/artifactId&gt;
			&lt;version&gt;1.0.2&lt;/version&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
					&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;guru.nidi.raml&lt;/groupId&gt;
			&lt;artifactId&gt;raml-tester&lt;/artifactId&gt;
			&lt;version&gt;0.8.8&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
			&lt;version&gt;1.7.1&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;



&lt;/project&gt;
  



    

 </pre></code></pre>File: <b id='essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/InsufficientScopeException.java'/>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/InsufficientScopeException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

public class InsufficientScopeException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/NoTenantException.java'/>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/NoTenantException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

public class NoTenantException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Tip.java'/>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/Tip.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Tip {
	
	@Id
    @GeneratedValue(strategy = GenerationType.AUTO)
	private long id;
    
    private String tenant; 
  
	private String tip;
  
	public Tip() {
	}

	public Tip(long id, String tip, String tenant) {
		this.id = id;
		this.tip = stripTip(tip);
		this.tenant = tenant;
	}

	public long getId() {
		return id;
	}

	public void setId(long id) {
		this.id = id;
	}

	public void setTip(String tip) {
		this.tip = stripTip(tip);
	}

	public String getTip() {
		return tip;
	}
	
	public String getTenant() {
		return tenant;
	}

	public void setTenant(String tenant) {
		this.tenant = tenant;
	}
	public String toString(){
		return "Tip[ Id: "+id +" Tip: "+ tip +" Tenant: "+tenant+"]\n";
	}
	private String stripTip(String tip){
		return tip==null ? null : tip.substring(0, Math.min(tip.length(), 200));
	}

	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		Tip other = (Tip) obj;
		if (id != other.id)
			return false;
		if (tenant == null) {
			if (other.tenant != null)
				return false;
		} else if (!tenant.equals(other.tenant))
			return false;
		if (tip == null) {
			if (other.tip != null)
				return false;
		} else if (!tip.equals(other.tip))
			return false;
		return true;
	}
}
</code></pre>File: <b id='essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipController.java'/>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;
import org.springframework.http.HttpHeaders;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.hybris.yaas.bites.TipsRepo;		

@RestController
public class TipController {
    
	private final Logger LOG = LoggerFactory.getLogger(TipController.class);

    @Autowired
    private TipsRepo repo;

    @CrossOrigin() 
    @RequestMapping( value="{tenantFromURL}/ping", method=RequestMethod.GET )
    public ResponseEntity<String> ping( 
    		@RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader, 
    		@RequestHeader(value="hybris-scopes", defaultValue="") String scopesFromHeader,
    		@PathVariable String tenantFromURL
    		) {
    	 
    	String s= "-> In GET "+tenantFromURL+"/ping: "+
 			   "  tenantFromURLPath: '"+tenantFromURL+
 			"',   hybris-tenant from token: '"+tenantFromHeader+
 			"',   hybris-scopes from token: '"+scopesFromHeader+"'";
    	LOG.debug(s);
    	
    	return new ResponseEntity<String>(s, HttpStatus.OK); 
    }
    
    @CrossOrigin()
    @RequestMapping( value="/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTipsForAllTenants( ) {
    	LOG.debug("-> In GET /tips ");
    	return new ResponseEntity<List<Tip>>( iterableToList( repo.findAll() ), HttpStatus.OK); 
    } 
    

    @CrossOrigin()
    @RequestMapping( value="/{tenant}/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTips(@RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader, @PathVariable String tenant ) {
    	LOG.debug("-> In GET /tips Tenant: "+tenant);
		if (tenant==null )
			throw new NoTenantException();
    	return new ResponseEntity<List<Tip>>( iterableToList(repo.findByTenant( tenant )), HttpStatus.OK); 
    }
    
    @CrossOrigin()
    @RequestMapping( value="/{tenant}/tips", method=RequestMethod.POST )
    public ResponseEntity<Void> postTip(  @RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader, @PathVariable String tenant, @RequestBody Tip t, UriComponentsBuilder ucBuilder ) {  	
    	LOG.debug("-> In POST /tips Tenant: "+tenant);
		if (tenant==null)
			throw new NoTenantException();
    	t.setTenant(tenant);    
    	repo.save( t );
    	
    	HttpHeaders newHeaders = new HttpHeaders();
    	newHeaders.setLocation(ucBuilder.path("/tips/{id}").buildAndExpand(t.getId()).toUri());
		return new ResponseEntity<Void>(newHeaders, HttpStatus.CREATED);         
    }
    
    @CrossOrigin()
    @RequestMapping( value="/{tenant}/tips/{id}", method=RequestMethod.PUT )
    public ResponseEntity<String> putTip( @RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader, 
    		@PathVariable String tenant, 
    		@PathVariable Long id, @RequestBody Tip t ) {
    	LOG.debug("-> In PUT /tips  Tenant: "+tenant);
		if (tenant==null)
			throw new NoTenantException();
    	t.setTenant(tenant);
    
    	synchronized(repo){
    		if (repo.exists(id)){
    			Tip oldTip = repo.findOne(id);
    			oldTip.setTip(t.getTip());
    			repo.save(oldTip);
    			return new ResponseEntity<String>( HttpStatus.OK); 
    		}
    	}  	
    	return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{\"message\":\"Tip "+id+" not found\"}");
    }
    
    @CrossOrigin()
    @RequestMapping( value="/{tenant}/tips/{id}", method=RequestMethod.DELETE )
    public ResponseEntity<String> deleteTip(  @RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader, @PathVariable String tenant, @PathVariable Long id ) {
    	LOG.debug("-> In DELETE /tips  Tenant: "+tenant);
		if (tenant==null)
			throw new NoTenantException();

    	synchronized(repo){
    		if (repo.exists(id) && repo.findOne(id).getTenant().equals(tenant)){
    			repo.delete(id);
    			return new ResponseEntity<String>(HttpStatus.NO_CONTENT); // If not found, could return HttpStatus.NOT_FOUND
    		}
    	}  	
       	return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{\"message\":\"Tip "+id+" not found\"}");
    }
   
    @CrossOrigin()
    @RequestMapping( value="/tips", method=RequestMethod.DELETE )
    public ResponseEntity<String> sensitiveMethodForVIPsOnly(  
    		@RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader,
    		@RequestHeader(value="hybris-scopes", defaultValue="") String scopesFromHeader
    		) {
    	LOG.debug("-> In sensitiveMethodForVIPsOnly /tips  tenantFromHeader: "+tenantFromHeader +" scopesFromHeader:"+scopesFromHeader);
    	if (!scopesFromHeader.contains("hybris.tips_vip"))
    		throw new InsufficientScopeException();
		if (tenantFromHeader==null)
			throw new NoTenantException();

		repo.deleteAll();
		
    	return new ResponseEntity<String>(HttpStatus.OK); 
    }
    
	private static <T> List<T> iterableToList(Iterable<T> iterable) {
	  List<T> list = new ArrayList<>();
	  iterable.forEach(list::add);
	  return list;
	}
	
	// Convert a predefined exception to an HTTP Status code
	@ResponseStatus(value=HttpStatus.BAD_REQUEST, reason="No Tenant Defined")  // 400
	@ExceptionHandler(NoTenantException.class)
	public void anyName() {
	   // Spring transforms the exception to an Http Response
	}
	
	
	// Convert a predefined exception to an HTTP Status code
	@ResponseStatus(value=HttpStatus.BAD_REQUEST, reason="Missing appropriate scope")  // 400
	@ExceptionHandler(InsufficientScopeException.class)
	public void anyOtherName() {
	   // Spring transforms the exception to an Http Response
	}
	
}

</code></pre>File: <b id='essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipsRepo.java'/>essentials/yaasbite400/src/main/java/com/hybris/yaas/bites/TipsRepo.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.List;

import org.springframework.data.repository.CrudRepository;

public interface TipsRepo extends CrudRepository<Tip, Long> {
	List<Tip> findByTenant(String tenant);
}
</code></pre>File: <b id='essentials/yaasbite400/src/main/webapp/index.html'/>essentials/yaasbite400/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;		
&lt;script&gt;

function entryWithEquals(str) {
	return str.includes("=")
}
function entryWithoutEquals(str) {
	return !str.includes("=")
}
var app = angular.module('tipsApp', ['restangular']);

app.config(function(RestangularProvider) {
	var location = window.location.href.replace("/#", "");
	location = location.replace("index.html", "");
	RestangularProvider.setBaseUrl(location);
});

app.controller('tipsController', function($scope, Restangular, $http ) {	
		
	$scope.LOCAL_URL="http://localhost:8080" // PERHAPS NEEDS_ADJUSTING IF YOU CHANGE YOUR DEFAULT PORTS
	$scope.CLOUD_URL="https://klyaasbite4.cfapps.us10.hana.ondemand.com" // NEEDS_ADJUSTING BUT KEEP HTTPS PROTOCOL
	$scope.SERVICES_API_PROXY_URL="https://api.eu.yaas.io/yb0160913/oct26s1/oct26s1" // NEEDS_ADJUSTING BUT KEEP HTTPS PROTOCOL
	
	
	// NEEDS_ADJUSTING - DO YOU WANT A TOKEN FOR THE E.U. OR FOR THE U.S.? 
	$scope.OAUTH_URL = "https://api.eu.yaas.io/hybris/oauth2/v1/token";	// NEEDS_ADJUSTING - USE IF YOU REQUIRE A TOKEN FOR THE E.U.
	//$scope.OAUTH_URL = "https://api.yaas.io/hybris/oauth2/v1/token";	// NEEDS_ADJUSTING - USE IF YOU REQUIRE A TOKEN FOR THE U.S.
	
	
	$scope.setBaseUrl = function(useTenant){			
		if ($scope.serverLocation==="local")
			$scope.tips_service_url =$scope.LOCAL_URL
		else if ($scope.serverLocation==="cloud")
			$scope.tips_service_url = $scope.CLOUD_URL  
		else {
			$scope.tips_service_url = $scope.SERVICES_API_PROXY_URL
			$scope.tenantName = $scope.tokenDetailsTenant;
		}
		if (useTenant)
			Restangular.setBaseUrl($scope.tips_service_url+"/"+$scope.tenantName);
		else
			Restangular.setBaseUrl($scope.tips_service_url);		
	}
	
	$scope.getReadyToCall = function( restangular, useTenant ){
		$scope.responseData=null
		$scope.errorMessage=null
		$scope.setBaseUrl(useTenant);
		if ($scope.includeToken=='YES')
			restangular.setDefaultHeaders({Authorization:'Bearer '+ $scope.token});
		else
			restangular.setDefaultHeaders({});		
	}
	
	$scope.ping = function(){
		if(!$scope.validateTenantName(false))
    		return;

		$scope.getReadyToCall(Restangular, true)	
		Restangular.one("ping").get().then(		
			function(data) {
				$scope.responseData = data.toString(); //Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	$scope.getAllTips = function(){
		$scope.getReadyToCall(Restangular, false)	
		Restangular.all("tips").getList().then(
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
	$scope.getTips = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false))
    		return;

		Restangular.all("tips").getList().then(		
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
	$scope.sensitiveMethodForVIPsOnly = function(){
		$scope.getReadyToCall(Restangular, false)	
		Restangular.all("tips").remove().then(		
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
    $scope.postTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false) || !$scope.validateText(true))
			return;
		var json = { 'tip': ''+$scope.tipText }    	
		Restangular.all("tips").post(json).then(
			function(data) {
    			$scope.getTips()
	    	}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
    $scope.putTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false) || !$scope.validateId(true) || !$scope.validateText(false) )
			return;
    	var json = { 'tip': ''+$scope.tipText }    	
    	Restangular.one("tips/"+$scope.tipId).customPUT(json).then(
    		function(data) {
				$scope.getTips()
    		}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
    $scope.deleteTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false) || !$scope.validateId(true))
			return;
    	Restangular.one("tips/"+$scope.tipId).remove().then(
    		function(data) {
    			$scope.getTips()
        	}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
	$scope.validateText = function(clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipText)
			return true;
		$scope.errorMessage = "Woops, no Tip Text has been given";
		return false;
	}
	
	$scope.validateId = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipId && $scope.tipId &gt;-1)
			return true;
		$scope.errorMessage = "Woops, the ID is empty or invalid";
		return false;
	}
	
	$scope.requestToken = function(){
		$scope.responseData=null
		$scope.errorMessage=null
		
		if (!$scope.clientid || !$scope.clientsecret){
			$scope.errorMessage = "Woops, you must enter a (valid) ClientID and ClientSecret";	
			return ;
		}		
		console.log("requestedscopes"+$scope.requestedscopes)
		if ($scope.requestedscopes === undefined)
			$scope.requestedscopes=''
		$http({
			url : $scope.OAUTH_URL,
			method : 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
		 	data:  $.param({
		 		'grant_type':'client_credentials',
		 		'client_id':''+$scope.clientid,
		 		'client_secret': ''+$scope.clientsecret,
		 		'scope': ''+$scope.requestedscopes
		 	})
		}).success(function(data, status, headers, config) {	
			$scope.token = data.access_token;
			$scope.tokenDetails = data.scope;
			// Reply is of the form: "scope":"hybris.org_manage hybris.tenant=yaasgulps", which is confusing.  Separate out the tenant from the scopes
			
			$scope.tokenDetailsTenant = data.scope.split(" ").filter( entryWithEquals )[0].replace("hybris.tenant=","");
			$scope.tokenDetailsScopes = data.scope.split(" ").filter( entryWithoutEquals ).toString();
			
		}).error(function(data, status, headers, config) {
			$scope.token = '';
			$scope.errorMessage = "Woops, error occured in Getting token: "+ data.error 
		}); 
	}
	
	$scope.validateTenantName = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tenantName)
			return true;
		$scope.errorMessage = "Woops, please provide a name for the Tenant field, eg. Adidas, or Nike, ..";
		return false;
	}
	
	$scope.token = null;
	$scope.includeToken='NO'	
	$scope.serverLocation='local'
	$scope.getReadyToCall(Restangular)	
});

&lt;/script&gt;

&lt;body  ng-app=tipsApp ng-controller="tipsController" &gt;

&lt;h2&gt;YaaS Bite: Tokens and  Scopes&lt;/h2&gt;	
	
	A client-front-end to request a token and use it to call the Tips Service.&lt;br&gt;

	&lt;h3&gt;Get a token:&lt;/h3&gt;
	&lt;a href="#" ng-click="requestToken()"&gt;Request a YaaS Token&lt;/a&gt; for the YaaS Entity whose ClientID and ClientSecret are:&lt;br&gt;
	&nbsp;&nbsp; Client ID: &lt;input name=clientid ng-model="clientid"&gt; &lt;br&gt;
	&nbsp;&nbsp; Client Secret: &lt;input name=clientsecret ng-model="clientsecret"&gt; &lt;br&gt;			
	&nbsp;&nbsp; Requested Scopes (Optional space separated list of scopes): &lt;input name=requestedscopes ng-model="requestedscopes"&gt; 
	
	&lt;div ng-show="token"&gt;
		&lt;h3&gt;Token returned:&lt;/h3&gt;
		Token Value: {{token}}&lt;br&gt;
		Token Tenant (on whose behalf are these calls being made): {{tokenDetailsTenant}} &lt;br&gt;
		Token Scopes (which special permissions does this token have): {{tokenDetailsScopes}}&lt;br&gt;
		
		
		&lt;h3&gt;Select target for REST Calls&lt;/h3&gt;
		Local server &lt;input type="radio" ng-model="serverLocation" value=local ng-change='setBaseUrl()'&gt; @ {{LOCAL_URL}}&lt;br&gt; 
		Server in cloud &lt;input type="radio" ng-model="serverLocation" value=cloud  ng-change='setBaseUrl()'&gt; @ {{CLOUD_URL}}&lt;br&gt;
		Server in cloud via api proxy &lt;input type="radio" ng-model="serverLocation" value=apiproxy  ng-change='setBaseUrl()'&gt; @ {{SERVICES_API_PROXY_URL}}&lt;br&gt;		
		
		&lt;h3&gt;Make REST calls to Tips Service&lt;/h3&gt;	
		Include Token in headers to Tips webservice? 
		Yes &lt;input ng-disabled="!token" type="radio" ng-model="includeToken" value=YES &gt;
		No &lt;input ng-disabled="!token" type="radio" ng-model="includeToken " value=NO  &gt;&lt;br&gt;		
			
		Tenant name:&lt;input name=tenantName ng-model="tenantName"/&gt;&lt;br&gt;					
		Ping the service @ &lt;a href="#" ng-click="ping()"&gt;{{tenantName}}/ping&lt;/a&gt;&lt;br&gt;
		Get tips for tenant {{tenantName}} &lt;a href="#" ng-click="getTips()"&gt;Call GET {{tenantName}}/tips&lt;/a&gt;&lt;br&gt;
		Post tip for tenant {{tenantName}} &lt;a href="#" ng-click="postTip()"&gt;Call POST {{tenantName}}/tips&lt;/a&gt; with "{ 'tip': ' &lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Adjust tip for tenant {{tenantName}} &lt;a href="#" ng-click="putTip()"&gt;Call PUT {{tenantName}}/tips/&lt;/a&gt; &lt;input name=tipId ng-model="tipId" type="number" /&gt; with "{ 'tip': '&lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Delete tip for tenant {{tenantName}} &lt;a href="#" ng-click="deleteTip()"&gt;Call DELETE {{tenantName}}/tips&lt;/a&gt; &lt;input name=tipId ng-model="tipId"  type="number" /&gt; &lt;br&gt;
		Get all tips from all tenants: &lt;/b&gt;&lt;a href="#" ng-click="getAllTips()"&gt;Call GET /tips&lt;/a&gt;&lt;br&gt;		
		Invoke sensitiveMethodForVIPsOnly: &lt;/b&gt;&lt;a href="#" ng-click="sensitiveMethodForVIPsOnly()"&gt;Call DELETE /tips&lt;/a&gt; (Requires scope hybris.tips_vip)&lt;br&gt;		
	
		&lt;h3 ng-show="responseData!=null"&gt;Response:&lt;/h3&gt;&lt;div style="color:green" ng-show="responseData!=null"&gt;{{responseData|json}}&lt;/div&gt;
	&lt;/div&gt;	 
	&lt;p style="color:red" ng-show="errorMessage"&gt;{{errorMessage|json}}&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite400/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite400/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

    
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite400/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbite400/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.*;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.util.Arrays;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.TestRestTemplate;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;


@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")
public class SanityTest {

	private final String TENANT="ADIDAS";
	private final String HOMEPAGE = "http://localhost:8080/";
	private final String TENANTENDPOINT = HOMEPAGE+TENANT+"/tips";
	private HttpHeaders headers;
	
	@Before
	public void setUpTenantInHeadaer(){
		headers = new HttpHeaders();
		headers.add("hybris-tenant", TENANT);
	}

	@Test(timeout = 60000) 
	public void siteIsAwakeAndWorking() throws Exception {		
		
		final TestRestTemplate restTemplate = new TestRestTemplate();
		HttpEntity<Tip> emptyEntityWithTenantHeader = new HttpEntity<Tip>( headers );
        Object o = restTemplate.exchange(TENANTENDPOINT, HttpMethod.GET, emptyEntityWithTenantHeader,Object.class).getBody();
        Tip[] tips = restTemplate.exchange(TENANTENDPOINT, HttpMethod.GET, emptyEntityWithTenantHeader, Tip[].class).getBody();
        assertTrue( "Should have 0 tips", Arrays.asList(tips).size() == 0);
        
		Tip newTip = new Tip(1, "Hello World!",TENANT);
        
		HttpEntity<Tip> newTipAsEntity = new HttpEntity<Tip>( newTip, headers );
        restTemplate.postForEntity(TENANTENDPOINT, newTipAsEntity, Object.class);
//		restTemplate.put(TENANTENDPOINT, newTipAsEntity);
		
		tips = restTemplate.exchange(TENANTENDPOINT, HttpMethod.GET, emptyEntityWithTenantHeader, Tip[].class).getBody();       
        assertTrue( "Should have 1 tips", Arrays.asList(tips).size() == 1);        
        assertTrue( "Tip should be what we just posted", newTip.equals( tips[0]) );    

        Tip updatedTip = new Tip(1, "Updated tip",TENANT);    
        final HttpEntity<Tip> updatedTipAsEntity = new HttpEntity<Tip>( updatedTip, headers );  
        restTemplate.put(TENANTENDPOINT, updatedTipAsEntity );
        
        tips = restTemplate.exchange(TENANTENDPOINT, HttpMethod.GET, emptyEntityWithTenantHeader, Tip[].class).getBody();       
        assertTrue( "Should have 1 tips", Arrays.asList(tips).size() == 1);        
     //   assertTrue( "Tip should be what we just updated", updatedTip.equals( tips[0]) );    
        
        restTemplate.exchange(TENANTENDPOINT+"/1", HttpMethod.DELETE, emptyEntityWithTenantHeader, String.class);
        tips = restTemplate.exchange(TENANTENDPOINT, HttpMethod.GET, emptyEntityWithTenantHeader, Tip[].class).getBody();       
        assertTrue( "Should have 0 tips", Arrays.asList(tips).size() == 0);        
        
    }

}
</code></pre>File: <b id='essentials/yaasbite500/pom.xml'/>essentials/yaasbite500/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.paths.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite5&lt;/artifactId&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;yaasbite5&lt;/name&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.sap.cloud.yaas.raml-parser&lt;/groupId&gt;
			&lt;artifactId&gt;raml-parser&lt;/artifactId&gt;
			&lt;version&gt;1.0.2&lt;/version&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
					&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;guru.nidi.raml&lt;/groupId&gt;
			&lt;artifactId&gt;raml-tester&lt;/artifactId&gt;
			&lt;version&gt;0.8.8&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt; &lt;!-- For MockMVC Assert Content.. --&gt;
		    &lt;groupId&gt;org.skyscreamer&lt;/groupId&gt;
		    &lt;artifactId&gt;jsonassert&lt;/artifactId&gt;
		    &lt;version&gt;0.9.0&lt;/version&gt;
		&lt;/dependency&gt;	
		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
			&lt;version&gt;1.7.1&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		

	  
	  
	   &lt;plugin&gt;
        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;copy-resources&lt;/id&gt;
            &lt;!-- here the phase you need --&gt;
            &lt;phase&gt;validate&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;copy-resources&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;outputDirectory&gt;${basedir}/target/${project.artifactId}-${project.version}/meta-data&lt;/outputDirectory&gt;
              &lt;resources&gt;          
                &lt;resource&gt;
                  &lt;directory&gt;src/main/resources&lt;/directory&gt;              
                   &lt;excludes&gt;
			          &lt;exclude&gt;application.properties&lt;/exclude&gt;
			        &lt;/excludes&gt;
                &lt;/resource&gt;
              &lt;/resources&gt;              
            &lt;/configuration&gt;            
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      
    &lt;/plugins&gt;
		
	&lt;/build&gt;
	
	

&lt;/project&gt;
  
 </pre></code></pre>File: <b id='essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Application.java'/>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Tip.java'/>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/Tip.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Tip {
	
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
	private long id;
	private String tip;

	public Tip() {
	}

	public Tip(long id, String tip) {
		this.id = id;
		this.tip = tip;
	}

	public long getId() {
		return id;
	}

	public void setId(long id) {
		this.id = id;
	}

	public void setTip(String tip) {
		this.tip = tip;
	}

	public String getTip() {
		return tip;
	}
	
	public String toString(){
		return "Tip[ Id: "+id +" Tip: "+ tip +"]\n";
	}
}
</code></pre>File: <b id='essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipController.java'/>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;
	
@RestController
public class TipController {
    
	private final Logger LOG = LoggerFactory.getLogger(TipController.class);

    @Autowired
    private TipsRepo repo;

    @RequestMapping( value="/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTips(@RequestHeader Map<String,String> headers ) {   

    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In GET /tips "+yap.toString());
    	
    	return new ResponseEntity<List<Tip>>( iterableToList(repo.findAll()), HttpStatus.OK); 
    }
    
    @RequestMapping( value="/tips", method=RequestMethod.POST )
    public ResponseEntity<Void> postTip( @RequestHeader Map<String,String> headers,  @RequestBody Tip t, UriComponentsBuilder ucBuilder ) {  	
    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In POST /tips "+yap); 	
    	repo.save( t );
    	
    	HttpHeaders newHeaders = new HttpHeaders();
    	newHeaders.setLocation(ucBuilder.path("/tips/{id}").buildAndExpand(t.getId()).toUri());
		return new ResponseEntity<Void>(newHeaders, HttpStatus.CREATED);  
    }
    
    @RequestMapping( value="/tips/{id}", method=RequestMethod.PUT )
    public ResponseEntity<Tip> putTip( @RequestHeader Map<String,String> headers, @PathVariable Long id, @RequestBody Tip t ) {
    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In PUT /tips "+yap);
    	
    	synchronized(repo){
    		if (repo.exists(id)){
    			Tip oldTip = repo.findOne(id);
    			oldTip.setTip(t.getTip());
    			repo.save(oldTip);
    			return new ResponseEntity<Tip>(t, HttpStatus.OK); 
    		}
    	}  	
    	return new ResponseEntity<Tip>(HttpStatus.NOT_FOUND);
    }
    
    @RequestMapping( value="/tips/{id}", method=RequestMethod.DELETE )
    public ResponseEntity<Tip> deleteTip( @RequestHeader Map<String,String> headers,  @PathVariable Long id ) {
    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In DELETE /tips "+yap);
    	
    	synchronized(repo){
    		if (repo.exists(id)){
    			repo.delete(id);
    			return new ResponseEntity<Tip>(HttpStatus.NO_CONTENT); // If not found, could return HttpStatus.NOT_FOUND
    		}
    	}  	
    	return new ResponseEntity<Tip>(HttpStatus.NOT_FOUND);
    }
   
	private static <T> List<T> iterableToList(Iterable<T> iterable) {
	  List<T> list = new ArrayList<>();
	  iterable.forEach(list::add);
	  return list;
	}
	
}
</code></pre>File: <b id='essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipsRepo.java'/>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/TipsRepo.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import org.springframework.data.repository.CrudRepository;

public interface TipsRepo extends CrudRepository<Tip, Long> {
}
</code></pre>File: <b id='essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java'/>essentials/yaasbite500/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import java.util.Map;


public class YaasAwareParameters
{
	private String hybrisTenant;
	private String hybrisClient;
	private String hybrisUser;
	private String hybrisScopes;
	private String hybrisRequestId;
	private Integer hybrisHop;

	public YaasAwareParameters(){
		
	}
	
	public YaasAwareParameters( Map<String,String> headers ){
    	if (headers!=null){
			setHybrisHop(Integer.getInteger(headers.get("hybris-hop"),1));    	
			setHybrisClient(headers.get("hybris-client"));
			setHybrisTenant(headers.get("hybris-tenant"));
			setHybrisUser(headers.get("hybris-user"));
			setHybrisScopes(headers.get("hybris-scopes"));
			setHybrisRequestId(headers.get("hybris-request-id"));
    	}
	}
	
	public String getHybrisTenant()
	{
		return hybrisTenant;
	}

	public String getHybrisClient()
	{
		return hybrisClient;
	}

	public String getHybrisUser()
	{
		return hybrisUser;
	}

	public String getHybrisScopes()
	{
		return hybrisScopes;
	}

	public String getHybrisRequestId()
	{
		return hybrisRequestId;
	}

	public Integer getHybrisHop()
	{
		return hybrisHop;
	}

	public void setHybrisTenant(final String hybrisTenant)
	{
		this.hybrisTenant = hybrisTenant;
	}

	public void setHybrisClient(final String hybrisClient)
	{
		this.hybrisClient = hybrisClient;
	}

	public void setHybrisUser(final String hybrisUser)
	{
		this.hybrisUser = hybrisUser;
	}

	public void setHybrisScopes(final String hybrisScopes)
	{
		this.hybrisScopes = hybrisScopes;
	}

	public void setHybrisRequestId(final String hybrisRequestId)
	{
		this.hybrisRequestId = hybrisRequestId;
	}

	public void setHybrisHop(final Integer hybrisHop)
	{
		this.hybrisHop = hybrisHop;
	}

	public String toString(){
		String s = 
				"\n-> YaaSAwareParameter: YAP Client: "+ getHybrisClient() + 
				"\nYAP Scope: "+ getHybrisScopes() + 
				"\nYAP Tenant: "+ getHybrisTenant() + 
				"\nYAP User: "+ getHybrisUser()+
				"\nYAP RequestId: "+ getHybrisRequestId() +"\n";
		return s;			
	}
}
</code></pre>File: <b id='essentials/yaasbite500/src/main/webapp/apiconsole/index.html'/>essentials/yaasbite500/src/main/webapp/apiconsole/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;title&gt;API Console&lt;/title&gt;
  &lt;link href="./styles/api-console-light-theme.css" rel="stylesheet" class="theme"&gt;
&lt;/head&gt;
&lt;body ng-app="ramlConsoleApp" ng-cloak class="raml-console-body"&gt;
  &lt;raml-initializer&gt;&lt;/raml-initializer&gt;
  &lt;script src="scripts/api-console-vendor.js"&gt;&lt;/script&gt;
  &lt;script src="scripts/api-console.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    $.noConflict();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite500/src/main/webapp/index.html'/>essentials/yaasbite500/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;		
&lt;script&gt;

function entryWithEquals(str) {
	return str.includes("=")
}
function entryWithoutEquals(str) {
	return !str.includes("=")
}
var app = angular.module('tipsApp', ['restangular']);

app.config(function(RestangularProvider) {
	var location = window.location.href.replace("/#", "");
	location = location.replace("index.html", "");
	RestangularProvider.setBaseUrl(location);
});

app.controller('tipsController', function($scope, Restangular, $http ) {	
		
	$scope.LOCAL_URL="http://localhost:8080" // PERHAPS NEEDS_ADJUSTING IF YOU CHANGE YOUR DEFAULT PORTS
	$scope.CLOUD_URL="https://yaasbite4.cfapps.us10.hana.ondemand.com" // NEEDS_ADJUSTING BUT KEEP HTTPS PROTOCOL
	$scope.SERVICES_API_PROXY="https://api.yaas.io/yaasgulps/yaasbites4/v1" // NEEDS_ADJUSTING BUT KEEP HTTPS PROTOCOL
	
	// NEEDS_ADJUSTING - DO YOU WANT A TOKEN FOR THE E.U. OR FOR THE U.S.? 
	$scope.OAUTH_URL = "https://api.eu.yaas.io/hybris/oauth2/v1/token";	// NEEDS_ADJUSTING - USE IF YOU REQUIRE A TOKEN FOR THE E.U.
	//$scope.OAUTH_URL = "https://api.yaas.io/hybris/oauth2/v1/token";	// NEEDS_ADJUSTING - USE IF YOU REQUIRE A TOKEN FOR THE U.S.
	
	$scope.setBaseUrl = function(useTenant){			
		if ($scope.serverLocation==="local")
			$scope.tips_service_url =$scope.LOCAL_URL // PERHAPS NEEDS_ADJUSTING IF YOU CHANGE YOUR DEFAULT PORTS
		else if ($scope.serverLocation==="cloud")
			$scope.tips_service_url = $scope.CLOUD_URL  // NEEDS_ADJUSTING BUT KEEP HTTPS PROTOCOL
		else 
			$scope.tips_service_url = $scope.SERVICES_API_PROXY// NEEDS_ADJUSTING
		if (useTenant)
			Restangular.setBaseUrl($scope.tips_service_url+"/"+$scope.tenantName);
		else
			Restangular.setBaseUrl($scope.tips_service_url);		
	}
	
	$scope.getReadyToCall = function( restangular, useTenant ){
		$scope.responseData=null
		$scope.errorMessage=null
		$scope.setBaseUrl(useTenant);
		if ($scope.includeToken=='YES')
			restangular.setDefaultHeaders({Authorization:'Bearer '+ $scope.token});
		else
			restangular.setDefaultHeaders({});		
	}
	
	$scope.ping = function(){
		if(!$scope.validateTenantName(false))
    		return;

		$scope.getReadyToCall(Restangular, true)	
		Restangular.one("ping").get().then(		
			function(data) {
				$scope.responseData = data.toString(); //Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	$scope.getAllTips = function(){
		$scope.getReadyToCall(Restangular, false)	
		Restangular.all("tips").getList().then(
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
	$scope.getTips = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false))
    		return;

		Restangular.all("tips").getList().then(		
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
	$scope.sensitiveMethodForVIPsOnly = function(){
		$scope.getReadyToCall(Restangular, false)	
		Restangular.all("tips").remove().then(		
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
    $scope.postTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false) || !$scope.validateText(true))
			return;
		var json = { 'tip': ''+$scope.tipText }    	
		Restangular.all("tips").post(json).then(
			function(data) {
    			$scope.getTips()
	    	}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
    $scope.putTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false) || !$scope.validateId(true) || !$scope.validateText(false) )
			return;
    	var json = { 'tip': ''+$scope.tipText }    	
    	Restangular.one("tips/"+$scope.tipId).customPUT(json).then(
    		function(data) {
				$scope.getTips()
    		}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
    $scope.deleteTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateTenantName(false) || !$scope.validateId(true))
			return;
    	Restangular.one("tips/"+$scope.tipId).remove().then(
    		function(data) {
    			$scope.getTips()
        	}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
	$scope.validateText = function(clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipText)
			return true;
		$scope.errorMessage = "Woops, no Tip Text has been given";
		return false;
	}
	
	$scope.validateId = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipId && $scope.tipId &gt;-1)
			return true;
		$scope.errorMessage = "Woops, the ID is empty or invalid";
		return false;
	}
	
	$scope.requestToken = function(){
		$scope.responseData=null
		$scope.errorMessage=null
		
		if (!$scope.clientid || !$scope.clientsecret){
			$scope.errorMessage = "Woops, you must enter a (valid) ClientID and ClientSecret";	
			return ;
		}		
		console.log("requestedscopes"+$scope.requestedscopes)
		if ($scope.requestedscopes === undefined)
			$scope.requestedscopes=''
		$http({
			url : $scope.OAUTH_URL,
			method : 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
		 	data:  $.param({
		 		'grant_type':'client_credentials',
		 		'client_id':''+$scope.clientid,
		 		'client_secret': ''+$scope.clientsecret,
		 		'scope': ''+$scope.requestedscopes
		 	})
		}).success(function(data, status, headers, config) {	
			$scope.token = data.access_token;
			$scope.tokenDetails = data.scope;
			// Reply is of the form: "scope":"hybris.org_manage hybris.tenant=yaasgulps", which is confusing.  Separate out the tenant from the scopes
			
			$scope.tokenDetailsTenant = data.scope.split(" ").filter( entryWithEquals )[0].replace("hybris.tenant=","");
			$scope.tokenDetailsScopes = data.scope.split(" ").filter( entryWithoutEquals ).toString();
			
		}).error(function(data, status, headers, config) {
			$scope.token = '';
			$scope.errorMessage = "Woops, error occured in Getting token: "+ data.error 
		}); 
	}
	
	$scope.validateTenantName = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tenantName)
			return true;
		$scope.errorMessage = "Woops, please provide a name for the Tenant field, eg. Adidas, or Nike, ..";
		return false;
	}
	
	$scope.token = null;
	$scope.includeToken='NO'	
	$scope.serverLocation='local'
	$scope.getReadyToCall(Restangular)	
});

&lt;/script&gt;

&lt;body  ng-app=tipsApp ng-controller="tipsController" &gt;

&lt;h2&gt;YaaS Bite 5: RAML&lt;/h2&gt;	
	
	A client-front-end to request a token and use it to call the Tips Service.&lt;br&gt;

	&lt;h3&gt;Get a token:&lt;/h3&gt;
	&lt;a href="#" ng-click="requestToken()"&gt;Request a YaaS Token&lt;/a&gt; for the YaaS Entity whose ClientID and ClientSecret are:&lt;br&gt;
	&nbsp;&nbsp; Client ID: &lt;input name=clientid ng-model="clientid"&gt; &lt;br&gt;
	&nbsp;&nbsp; Client Secret: &lt;input name=clientsecret ng-model="clientsecret"&gt; &lt;br&gt;			
	&nbsp;&nbsp; Requested Scopes: &lt;input name=requestedscopes ng-model="requestedscopes"&gt; 
	
	&lt;div ng-show="token"&gt;
		&lt;h3&gt;Token returned:&lt;/h3&gt;
		Token Value: {{token}}&lt;br&gt;
		Token Tenant (on whose behalf are these calls being made): &lt;b&gt;{{tokenDetailsTenant}}&lt;/b&gt; - Tenant is ID of a YaaS DevTeam or of a YaaS Project &lt;br&gt;
		Token Scopes (which special permissions does this token have): {{tokenDetailsScopes}}&lt;br&gt;
		
		Include Token in headers to Tips webservice? 
		Yes &lt;input ng-disabled="!token" type="radio" ng-model="includeToken" value=YES &gt;
		No &lt;input ng-disabled="!toke q qn" type="radio" ng-model="includeToken " value=NO  &gt;		
		
		&lt;h3&gt;Select target for REST Calls&lt;/h3&gt;
		Local server &lt;input type="radio" ng-model="serverLocation" value=local ng-change='setBaseUrl()'&gt; @ {{LOCAL_URL}}&lt;br&gt; 
		Server in cloud &lt;input type="radio" ng-model="serverLocation" value=cloud  ng-change='setBaseUrl()'&gt; @ {{CLOUD_URL}}&lt;br&gt;
		Server in cloud via api proxy &lt;input type="radio" ng-model="serverLocation" value=apiproxy  ng-change='setBaseUrl()'&gt; @ {{SERVICES_API_PROXY}}&lt;br&gt;		
		
		&lt;h3&gt;Make REST calls to Tips Service&lt;/h3&gt;		
		Tenant name:&lt;input name=tenantName ng-model="tenantName"/&gt;&lt;br&gt;					
		Ping the service @ &lt;a href="#" ng-click="ping()"&gt;{{tenantName}}/ping&lt;/a&gt;&lt;br&gt;
		Get tips for tenant {{tenantName}} &lt;a href="#" ng-click="getTips()"&gt;Call GET {{tenantName}}/tips&lt;/a&gt;&lt;br&gt;
		Post tip for tenant {{tenantName}} &lt;a href="#" ng-click="postTip()"&gt;Call POST {{tenantName}}/tips&lt;/a&gt; with "{ 'tip': ' &lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Adjust tip for tenant {{tenantName}} &lt;a href="#" ng-click="putTip()"&gt;Call PUT {{tenantName}}/tips/&lt;/a&gt; &lt;input name=tipId ng-model="tipId" type="number" /&gt; with "{ 'tip': '&lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Delete tip for tenant {{tenantName}} &lt;a href="#" ng-click="deleteTip()"&gt;Call DELETE {{tenantName}}/tips&lt;/a&gt; &lt;input name=tipId ng-model="tipId"  type="number" /&gt; &lt;br&gt;
		Get all tips from all tenants: &lt;/b&gt;&lt;a href="#" ng-click="getAllTips()"&gt;Call GET /tips&lt;/a&gt;&lt;br&gt;		
		Invoke sensitiveMethodForVIPsOnly: &lt;/b&gt;&lt;a href="#" ng-click="sensitiveMethodForVIPsOnly()"&gt;Call DELETE /tips&lt;/a&gt; (Requires scope hybris.tips_vip)&lt;br&gt;		
	
		&lt;h3 ng-show="responseData!=null"&gt;Response:&lt;/h3&gt;&lt;div style="color:green" ng-show="responseData!=null"&gt;{{responseData|json}}&lt;/div&gt;
	&lt;/div&gt;	 
	&lt;p style="color:red" ng-show="errorMessage"&gt;{{errorMessage|json}}&lt;/p&gt;

	&lt;br&gt;
	&lt;h3&gt;Muelsoft's API Console showing the Tips RAML File in a Graphical Format:&lt;/h3&gt;
	
	&lt;!--  See https://github.com/mulesoft/api-console --&gt;
	&lt;iframe width=100%  height=600px src="apiconsole/index.html?raml=../meta-data/api.raml"/&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite500/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite500/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite500/src/test/java/com/hybris/yaaspathl/SpringTest.java'/>essentials/yaasbite500/src/test/java/com/hybris/yaaspathl/SpringTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspathl;

import static org.junit.Assert.assertTrue;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import guru.nidi.ramltester.RamlDefinition;
import guru.nidi.ramltester.RamlLoaders;
import guru.nidi.ramltester.SimpleReportAggregator;
import guru.nidi.ramltester.junit.ExpectedUsage;

import java.util.List;

import org.junit.Before;
import org.junit.ClassRule;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.raml.parser.rule.ValidationResult;
import org.raml.parser.visitor.RamlValidationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.web.WebAppConfiguration;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;
import org.springframework.web.context.WebApplicationContext;

import com.google.gson.Gson;
import com.hybris.yaaspaths.Application;
import com.hybris.yaaspaths.Tip;

@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration(classes = Application.class)
public class SpringTest {
	
	private static RamlDefinition api = RamlLoaders.fromClasspath().load( "api.raml" );	    
    private static SimpleReportAggregator aggregator = new SimpleReportAggregator();
    @ClassRule
    public static ExpectedUsage expectedUsage = new ExpectedUsage(aggregator);

    @Autowired
    private WebApplicationContext wac;

    private MockMvc mockMvc;

    @Before
    public void setup() {
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }
    
	@Test
	// Validate the syntax of the RAML fkle
	public void ramlCheck() {
		String ramlLocation = "src/main/resources/api.raml";
		List<ValidationResult> results = RamlValidationService.createDefault().validate(ramlLocation);
		results.stream().forEach( s -> System.out.println("--> "+s));
		assertTrue(results.size() == 0);
	}

    @Test
    // Test the service, and check that we have tested all of the api as described in the RAML
    public void tips() throws Exception {
		Gson gson = new Gson();
		
		mockMvc.perform(post("/tips")
			 .contentType(MediaType.APPLICATION_JSON)
			 .content(gson.toJson(new Tip(1, "Dont Eat Fireworks")))
			 .accept(MediaType.parseMediaType("application/json")))
			 .andExpect(api.matches().aggregating(aggregator))
			 .andExpect(status().isCreated());
	
		mockMvc.perform(get("/tips")
			.accept(MediaType.parseMediaType("application/json")))
			.andExpect(api.matches().aggregating(aggregator))
			.andExpect(status().isOk())
			.andExpect(content().json("[{id:1, tip: 'Dont Eat Fireworks'}]"));	
		
		mockMvc.perform(put("/tips/{id}", 1)
				.contentType(MediaType.APPLICATION_JSON)
				.content(gson.toJson(new Tip(1, "Do Eat Fireworks")))
				.accept(MediaType.parseMediaType("application/json")))
				.andExpect(api.matches().aggregating(aggregator))
				.andExpect(status().isOk())
				.andExpect(content().json("{id:1, tip: 'Do Eat Fireworks'}"));	

		mockMvc.perform(delete("/tips/{id}", 1)
				.contentType(MediaType.APPLICATION_JSON))
				.andExpect(api.matches().aggregating(aggregator))
		        .andExpect(status().isNoContent() );

	
		
    }
	
}
</code></pre>File: <b id='essentials/yaasbite600/pom.xml'/>essentials/yaasbite600/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.paths.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite6&lt;/artifactId&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;yaasbite6&lt;/name&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.sap.cloud.yaas.raml-parser&lt;/groupId&gt;
			&lt;artifactId&gt;raml-parser&lt;/artifactId&gt;
			&lt;version&gt;1.0.2&lt;/version&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
					&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;guru.nidi.raml&lt;/groupId&gt;
			&lt;artifactId&gt;raml-tester&lt;/artifactId&gt;
			&lt;version&gt;0.8.8&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt; &lt;!-- For MockMVC Assert Content.. --&gt;
		    &lt;groupId&gt;org.skyscreamer&lt;/groupId&gt;
		    &lt;artifactId&gt;jsonassert&lt;/artifactId&gt;
		    &lt;version&gt;0.9.0&lt;/version&gt;
		&lt;/dependency&gt;	
		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
			&lt;version&gt;1.7.1&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		

	  
	  
	   &lt;plugin&gt;
        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;copy-resources&lt;/id&gt;
            &lt;!-- here the phase you need --&gt;
            &lt;phase&gt;validate&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;copy-resources&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;outputDirectory&gt;${basedir}/target/${project.artifactId}-${project.version}/meta-data&lt;/outputDirectory&gt;
              &lt;resources&gt;          
                &lt;resource&gt;
                  &lt;directory&gt;src/main/resources&lt;/directory&gt;              
                   &lt;excludes&gt;
			          &lt;exclude&gt;application.properties&lt;/exclude&gt;
			        &lt;/excludes&gt;
                &lt;/resource&gt;
              &lt;/resources&gt;              
            &lt;/configuration&gt;            
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      
    &lt;/plugins&gt;
		
	&lt;/build&gt;
	
	

&lt;/project&gt;
  
 
</pre></code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Application.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/InsufficientScopeException.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/InsufficientScopeException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

public class InsufficientScopeException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/NoTenantException.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/NoTenantException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

public class NoTenantException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Tip.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/Tip.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Tip {
	
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
	private long id;
	private String tip;

	public Tip() {
	}

	public Tip(long id, String tip) {
		this.id = id;
		this.tip = tip;
	}

	public long getId() {
		return id;
	}

	public void setId(long id) {
		this.id = id;
	}

	public void setTip(String tip) {
		this.tip = tip;
	}

	public String getTip() {
		return tip;
	}
	
	public String toString(){
		return "Tip[ Id: "+id +" Tip: "+ tip +"]\n";
	}
}
</code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipController.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;

	
@RestController
public class TipController {
    
	private final Logger LOG = LoggerFactory.getLogger(TipController.class);

    @Autowired
    private TipsRepo repo;

    @CrossOrigin() 
    @RequestMapping( value="/ping", method=RequestMethod.GET )
    public ResponseEntity<String> ping( 
    		@RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader, 
    		@RequestHeader(value="hybris-scopes", defaultValue="") String scopesFromHeader
    		) {
 	 
    	String s= "-> In GET /ping: "+
 			"',   hybris-tenant from token: '"+tenantFromHeader+
 			"',   hybris-scopes from token: '"+scopesFromHeader+"'";
    	LOG.debug(s);   	
    	return new ResponseEntity<String>(s, HttpStatus.OK); 
    }
    
    @RequestMapping( value="/tips", method=RequestMethod.GET )
    public ResponseEntity<List<Tip>> getAllTips(@RequestHeader Map<String,String> headers ) {   

    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In GET /tips "+yap.toString());
    	
    	return new ResponseEntity<List<Tip>>( iterableToList(repo.findAll()), HttpStatus.OK); 
    }
    
    @RequestMapping( value="/tips", method=RequestMethod.POST )
    public ResponseEntity<Void> postTip( @RequestHeader Map<String,String> headers,  @RequestBody Tip t, UriComponentsBuilder ucBuilder ) {  	
    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In POST /tips "+yap); 	
    	repo.save( t );
    	
    	HttpHeaders newHeaders = new HttpHeaders();
    	newHeaders.setLocation(ucBuilder.path("/tips/{id}").buildAndExpand(t.getId()).toUri());
		return new ResponseEntity<Void>(newHeaders, HttpStatus.CREATED);  
    }
    
    @RequestMapping( value="/tips/{id}", method=RequestMethod.PUT )
    public ResponseEntity<Tip> putTip( @RequestHeader Map<String,String> headers, @PathVariable Long id, @RequestBody Tip t ) {
    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In PUT /tips "+yap);
    	
    	synchronized(repo){
    		if (repo.exists(id)){
    			Tip oldTip = repo.findOne(id);
    			oldTip.setTip(t.getTip());
    			repo.save(oldTip);
    			return new ResponseEntity<Tip>(t, HttpStatus.OK); 
    		}
    	}  	
    	return new ResponseEntity<Tip>(HttpStatus.NOT_FOUND);
    }
    
    @RequestMapping( value="/tips/{id}", method=RequestMethod.DELETE )
    public ResponseEntity<Tip> deleteTip( @RequestHeader Map<String,String> headers,  @PathVariable Long id ) {
    	YaasAwareParameters yap = new YaasAwareParameters(headers);
    	LOG.debug("-> In DELETE /tips "+yap);
    	
    	synchronized(repo){
    		if (repo.exists(id)){
    			repo.delete(id);
    			return new ResponseEntity<Tip>(HttpStatus.NO_CONTENT); // If not found, could return HttpStatus.NOT_FOUND
    		}
    	}  	
    	return new ResponseEntity<Tip>(HttpStatus.NOT_FOUND);
    }
   
    @CrossOrigin()
    @RequestMapping( value="/tips", method=RequestMethod.DELETE )
    public ResponseEntity<String> sensitiveMethodForVIPsOnly(  
    		@RequestHeader(value="hybris-tenant", defaultValue="") String tenantFromHeader,
    		@RequestHeader(value="hybris-scopes", defaultValue="") String scopesFromHeader
    		) {
    	LOG.debug("-> In sensitiveMethodForVIPsOnly /tips  tenantFromHeader: "+tenantFromHeader +" scopesFromHeader:"+scopesFromHeader);
    	if (!scopesFromHeader.contains("hybris.tips_vip"))
    		throw new InsufficientScopeException();
		if (tenantFromHeader==null)
			throw new NoTenantException();

		repo.deleteAll();
		
    	return new ResponseEntity<String>(HttpStatus.OK); 
    }
	private static <T> List<T> iterableToList(Iterable<T> iterable) {
	  List<T> list = new ArrayList<>();
	  iterable.forEach(list::add);
	  return list;
	}
	
}
</code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipsRepo.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/TipsRepo.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import org.springframework.data.repository.CrudRepository;

public interface TipsRepo extends CrudRepository<Tip, Long> {
}
</code></pre>File: <b id='essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java'/>essentials/yaasbite600/src/main/java/com/hybris/yaaspaths/YaasAwareParameters.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspaths;

import java.util.Map;


public class YaasAwareParameters
{
	private String hybrisTenant;
	private String hybrisClient;
	private String hybrisUser;
	private String hybrisScopes;
	private String hybrisRequestId;
	private Integer hybrisHop;

	public YaasAwareParameters(){
		
	}
	
	public YaasAwareParameters( Map<String,String> headers ){
    	if (headers!=null){
			setHybrisHop(Integer.getInteger(headers.get("hybris-hop"),1));    	
			setHybrisClient(headers.get("hybris-client"));
			setHybrisTenant(headers.get("hybris-tenant"));
			setHybrisUser(headers.get("hybris-user"));
			setHybrisScopes(headers.get("hybris-scopes"));
			setHybrisRequestId(headers.get("hybris-request-id"));
    	}
	}
	
	public String getHybrisTenant()
	{
		return hybrisTenant;
	}

	public String getHybrisClient()
	{
		return hybrisClient;
	}

	public String getHybrisUser()
	{
		return hybrisUser;
	}

	public String getHybrisScopes()
	{
		return hybrisScopes;
	}

	public String getHybrisRequestId()
	{
		return hybrisRequestId;
	}

	public Integer getHybrisHop()
	{
		return hybrisHop;
	}

	public void setHybrisTenant(final String hybrisTenant)
	{
		this.hybrisTenant = hybrisTenant;
	}

	public void setHybrisClient(final String hybrisClient)
	{
		this.hybrisClient = hybrisClient;
	}

	public void setHybrisUser(final String hybrisUser)
	{
		this.hybrisUser = hybrisUser;
	}

	public void setHybrisScopes(final String hybrisScopes)
	{
		this.hybrisScopes = hybrisScopes;
	}

	public void setHybrisRequestId(final String hybrisRequestId)
	{
		this.hybrisRequestId = hybrisRequestId;
	}

	public void setHybrisHop(final Integer hybrisHop)
	{
		this.hybrisHop = hybrisHop;
	}

	public String toString(){
		String s = 
				"\n-> YaaSAwareParameter: YAP Client: "+ getHybrisClient() + 
				"\nYAP Scope: "+ getHybrisScopes() + 
				"\nYAP Tenant: "+ getHybrisTenant() + 
				"\nYAP User: "+ getHybrisUser()+
				"\nYAP RequestId: "+ getHybrisRequestId() +"\n";
		return s;			
	}
}
</code></pre>File: <b id='essentials/yaasbite600/src/main/webapp/apiconsole/index.html'/>essentials/yaasbite600/src/main/webapp/apiconsole/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;title&gt;API Console&lt;/title&gt;
  &lt;link href="./styles/api-console-light-theme.css" rel="stylesheet" class="theme"&gt;
&lt;/head&gt;
&lt;body ng-app="ramlConsoleApp" ng-cloak class="raml-console-body"&gt;
  &lt;raml-initializer&gt;&lt;/raml-initializer&gt;
  &lt;script src="scripts/api-console-vendor.js"&gt;&lt;/script&gt;
  &lt;script src="scripts/api-console.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    $.noConflict();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite600/src/main/webapp/index.html'/>essentials/yaasbite600/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;		
&lt;script&gt;

function entryWithEquals(str) {
	return str.includes("=")
}
function entryWithoutEquals(str) {
	return !str.includes("=")
}
var app = angular.module('tipsApp', ['restangular']);

app.config(function(RestangularProvider) {
	var location = window.location.href.replace("/#", "");
	location = location.replace("index.html", "");
	RestangularProvider.setBaseUrl(location);
});

app.controller('tipsController', function($scope, Restangular, $http ) {	
		
	$scope.SERVICES_API_PROXY="https://api.eu.yaas.io/yb0160913/service600/service600" // NEEDS_ADJUSTING TO YOUR SERVICE'S API_PROXY URL, BUT KEEP THE HTTPS PROTOCOL
	$scope.SERVICES_CLOUD_URI="https://klyaasbite6.cfapps.us10.hana.ondemand.com" // NEEDS_ADJUSTING TO YOUR SERVICE'S CLOUD URL, BUT KEEP THE HTTPS PROTOCOL
	
	// NEEDS_ADJUSTING - DO YOU WANT A TOKEN FOR THE E.U. OR FOR THE U.S.? 
	$scope.OAUTH_URL = "https://api.eu.yaas.io/hybris/oauth2/v1/token";	// NEEDS_ADJUSTING - USE IF YOU REQUIRE A TOKEN FOR THE E.U.
	//$scope.OAUTH_URL = "https://api.yaas.io/hybris/oauth2/v1/token";	// NEEDS_ADJUSTING - USE IF YOU REQUIRE A TOKEN FOR THE U.S.
	
	$scope.CLIENT_ID = "1vMxmq9TjAkwIIvKvTyhNUVgj0Ge7skx"; // NEEDS_ADJUSTING TO THE CLIENT_ID OF YOUR CLIENT

	$scope.loggingIn = function() {	
		var ACCESS_TOKEN_IN_URL_PREFIX = "access_token=";
		
		var location = window.location.href.replace("/#", "").replace("index.html", "");	
		
		if (location.indexOf(ACCESS_TOKEN_IN_URL_PREFIX)==-1){ // The first time to this page, we will not have access_token in the URL
		    // Redirect to Yaas' OAuth2 endpoint, passing this page as the redirect_uri so that we come back to this page afterwards
			var target =  "https://api.yaas.io/hybris/oauth2/v1/authorize" + 
			"?response_type=token"+
			"&scope=hybris.tips_vip"+
			"&client_id="+ $scope.CLIENT_ID +
			"&redirect_uri="+ $scope.SERVICES_CLOUD_URI+"/index.html";	    
		    window.open(target );	
		    //=================
		}	
		else {			
			// If this URL does contain "access_token" it means we have already been redirected back to this page from Yaas' oauth2 service
			location = location.substring(location.indexOf( ACCESS_TOKEN_IN_URL_PREFIX ) + ACCESS_TOKEN_IN_URL_PREFIX.length);
			$scope.token = location.substring(0, location.indexOf("&"));
			$scope.analyzeToken();	
		}
	}
	
	$scope.setBaseUrl = function(useTenant){	
		console.log("IN SETBASEURL WITH "+$scope.SERVICES_API_PROXY)
		Restangular.setBaseUrl($scope.SERVICES_API_PROXY);		
	}
	
	$scope.getReadyToCall = function( restangular, useTenant ){
		$scope.responseData=null
		$scope.errorMessage=null
		$scope.setBaseUrl(useTenant);
		if ($scope.includeToken=='YES')
			restangular.setDefaultHeaders({Authorization:'Bearer '+ $scope.token});
		else
			restangular.setDefaultHeaders({});		
	}
	
	$scope.ping = function(){
		$scope.getReadyToCall(Restangular, true)	
		Restangular.one("ping").get().then(		
			function(data) {
				$scope.responseData = data.toString(); //Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

	$scope.getTips = function(){
		$scope.getReadyToCall(Restangular, true)	
	
		Restangular.all("tips").getList().then(		
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
	$scope.sensitiveMethodForVIPsOnly = function(){
		$scope.getReadyToCall(Restangular, false)	
		Restangular.all("tips").remove().then(		
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	
    $scope.postTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateText(true))
			return;
		var json = { 'tip': ''+$scope.tipText }    	
		Restangular.all("tips").post(json).then(
			function(data) {
    			$scope.getTips()
	    	}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
    $scope.putTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if(!$scope.validateId(true) || !$scope.validateText(false) )
			return;
    	var json = { 'tip': ''+$scope.tipText }    	
    	Restangular.one("tips/"+$scope.tipId).customPUT(json).then(
    		function(data) {
				$scope.getTips()
    		}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
    $scope.deleteTip = function(){
		$scope.getReadyToCall(Restangular, true)	
		if( !$scope.validateId(true))
			return;
    	Restangular.one("tips/"+$scope.tipId).remove().then(
    		function(data) {
    			$scope.getTips()
        	}, 
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}	
    
	$scope.validateText = function(clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipText)
			return true;
		$scope.errorMessage = "Woops, no Tip Text has been given";
		return false;
	}
	
	$scope.validateId = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipId && $scope.tipId &gt;-1)
			return true;
		$scope.errorMessage = "Woops, the ID is empty or invalid";
		return false;
	}
	
	$scope.analyzeToken = function(){
		$scope.responseData=null
		$scope.errorMessage=null
		$http({
			url : 'https://api.yaas.io/hybris/echo/v1/get',
			method : 'GET',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded',
				'Authorization':'Bearer '+$scope.token}
		}).success(function(data, status, headers, config) {	
			$scope.tokenDetails = data['hybris-scopes'] 
			$scope.tokenDetailsTenant = data['hybris-scopes'].split(" ").filter( entryWithEquals )[0].replace("hybris.tenant=","");
			$scope.tokenDetailsScopes = data['hybris-scopes'].split(" ").filter( entryWithoutEquals ).toString();
		}).error(function(data, status, headers, config) {
			$scope.errorMessage = "ERROR in Analyzing token: "+ data 
		}); 
	}
	
	$scope.token = null;
	$scope.includeToken='NO'	
	$scope.serverLocation='local'
	$scope.getReadyToCall(Restangular)	
});

&lt;/script&gt;

&lt;body  ng-app=tipsApp ng-controller="tipsController" ng-init="loggingIn()" &gt;

&lt;h2&gt;YaaS Bite 6: Login&lt;/h2&gt;	
	
	&lt;div ng-show="!token"&gt;
		If you see this, you have not yet logged in properly.  
		Be sure you are allowing pop-ups for this site, and follow &lt;a href="https://yaasbiteindex.cfapps.us10.hana.ondemand.com/#YaasBite6"&gt;YaasBite6&lt;/a&gt; to get this working.
	&lt;/div&gt;
	&lt;div ng-show="token"&gt;
	
		A client-front-end, reached after logging-in with the Implicit Grant Flow.&lt;br&gt;
	
	
		&lt;h3&gt;Token returned:&lt;/h3&gt;
		Token Value: {{token}}&lt;br&gt;
		Token Tenant (on whose behalf are these calls being made): {{tokenDetailsTenant}}&lt;br&gt;
		Token Scopes (which special permissions does this token have): {{tokenDetailsScopes}}&lt;br&gt;
		
		&lt;h3&gt;Make REST calls to Tips Service&lt;/h3&gt;		
		Include Token in headers to Tips webservice? 
		Yes &lt;input ng-disabled="!token" type="radio" ng-model="includeToken" value=YES &gt;
		No &lt;input ng-disabled="!token" type="radio" ng-model="includeToken " value=NO  &gt;		&lt;br&gt;&lt;br&gt;
		
		Tenant name: {{tokenDetailsTenant}}&lt;br&gt;					
		Ping the service @ &lt;a href="#" ng-click="ping()"&gt;/ping&lt;/a&gt;&lt;br&gt;
		Get tips for tenant {{tokenDetailsTenant}} &lt;a href="#" ng-click="getTips()"&gt;Call GET /tips&lt;/a&gt;&lt;br&gt;
		Post tip for tenant {{tokenDetailsTenant}} &lt;a href="#" ng-click="postTip()"&gt;Call POST /tips&lt;/a&gt; with "{ 'tip': ' &lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Adjust tip for tenant {{tokenDetailsTenant}} &lt;a href="#" ng-click="putTip()"&gt;Call PUT /tips/&lt;/a&gt; &lt;input name=tipId ng-model="tipId" type="number" /&gt; with "{ 'tip': '&lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Delete tip for tenant {{tokenDetailsTenant}} &lt;a href="#" ng-click="deleteTip()"&gt;Call DELETE /tips&lt;/a&gt; &lt;input name=tipId ng-model="tipId"  type="number" /&gt; &lt;br&gt;
		Invoke sensitiveMethodForVIPsOnly: &lt;/b&gt;&lt;a href="#" ng-click="sensitiveMethodForVIPsOnly()"&gt;Call DELETE /tips&lt;/a&gt; (Requires scope hybris.tips_vip)&lt;br&gt;		
	
		&lt;h3 ng-show="responseData!=null"&gt;Response:&lt;/h3&gt;&lt;div style="color:green" ng-show="responseData!=null"&gt;{{responseData|json}}&lt;/div&gt;
	&lt;/div&gt;	 
	&lt;p style="color:red" ng-show="errorMessage"&gt;{{errorMessage|json}}&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite600/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite600/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite600/src/test/java/com/hybris/yaaspathl/SpringTest.java'/>essentials/yaasbite600/src/test/java/com/hybris/yaaspathl/SpringTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaaspathl;

import static org.junit.Assert.assertTrue;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import guru.nidi.ramltester.RamlDefinition;
import guru.nidi.ramltester.RamlLoaders;
import guru.nidi.ramltester.SimpleReportAggregator;
import guru.nidi.ramltester.junit.ExpectedUsage;

import java.util.List;

import org.junit.Before;
import org.junit.ClassRule;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.raml.parser.rule.ValidationResult;
import org.raml.parser.visitor.RamlValidationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.web.WebAppConfiguration;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;
import org.springframework.web.context.WebApplicationContext;

import com.google.gson.Gson;
import com.hybris.yaaspaths.Application;
import com.hybris.yaaspaths.Tip;

@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration(classes = Application.class)
public class SpringTest {
	
	private static RamlDefinition api = RamlLoaders.fromClasspath().load( "api.raml" );	    
    private static SimpleReportAggregator aggregator = new SimpleReportAggregator();
    @ClassRule
    public static ExpectedUsage expectedUsage = new ExpectedUsage(aggregator);

    @Autowired
    private WebApplicationContext wac;

    private MockMvc mockMvc;

    @Before
    public void setup() {
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }
    
	@Test
	public void ramlCheck() {
		String ramlLocation = "src/main/resources/api.raml";
		List<ValidationResult> results = RamlValidationService.createDefault().validate(ramlLocation);
		results.stream().forEach( s -> System.out.println("--> "+s));
		assertTrue(results.size() == 0);
	}

   @Test
    public void tips() throws Exception {
		Gson gson = new Gson();
		
		mockMvc.perform(post("/tips")
			 .contentType(MediaType.APPLICATION_JSON)
			 .content(gson.toJson(new Tip(1, "Dont Eat Fireworks")))
			 .accept(MediaType.parseMediaType("application/json")))
			 .andExpect(api.matches().aggregating(aggregator))
			 .andExpect(status().isCreated());
	
		mockMvc.perform(get("/tips")
			.accept(MediaType.parseMediaType("application/json")))
			.andExpect(api.matches().aggregating(aggregator))
			.andExpect(status().isOk())
			.andExpect(content().json("[{id:1, tip: 'Dont Eat Fireworks'}]"))
			;	
    }
	

}
</code></pre>File: <b id='essentials/yaasbite700/index.html'/>essentials/yaasbite700/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang="en"&gt;
	&lt;meta charset="UTF-8"&gt;
	&lt;link href="https://builder.yaas.io/public/css/styles.css" rel="stylesheet"&gt;
	&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
	&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
	&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
	&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;
	&lt;script src="https://builder.yaas.io/public/js/builder.js"&gt;	&lt;/script&gt;
	&lt;script src="https://builder.yaas.io/public/js/builder_editors_v2.js"&gt;	&lt;/script&gt;
	&lt;script src="js/yaasBitesBuilderModule.js"&gt;	&lt;/script&gt;
	&lt;title&gt;YaasBitesBuilderModule&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;script&gt;
           Builder.initialize(function(){
               $("#header").append("Welcome " + Builder.currentAccountId + "!");
               $("#location").append(Builder.currentLocation);
               $("#token").append(Builder.authManager);
           });
	&lt;/script&gt;
	&lt;div ng-app="yaasBitesBuilderModuleApp" ng-controller="tipsCtrl" &gt;
		&lt;h3&gt;yaasBitesBuilderModuleApp&lt;/h3&gt; 
		&lt;a ng-click="getTips()"&gt;Get all Tips&lt;/a&gt;&lt;br&gt;
		&lt;pre&gt;{{restResponse|json}}&lt;/pre&gt;		
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></code></pre>File: <b id='essentials/yaasbite700/pom.xml'/>essentials/yaasbite700/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbites7&lt;/artifactId&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
	&lt;packaging&gt;pom&lt;/packaging&gt;
	&lt;name&gt;yaasbites7&lt;/name&gt;

&lt;/project&gt;

</pre></code></pre>File: <b id='essentials/yaasbite800/pom.xml'/>essentials/yaasbite800/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite8&lt;/artifactId&gt;
	&lt;name&gt;yaasbite8&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.sap.cloud.yaas.raml-parser&lt;/groupId&gt;
			&lt;artifactId&gt;raml-parser&lt;/artifactId&gt;
			&lt;version&gt;1.0.2&lt;/version&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
					&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;guru.nidi.raml&lt;/groupId&gt;
			&lt;artifactId&gt;raml-tester&lt;/artifactId&gt;
			&lt;version&gt;0.8.8&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
			&lt;version&gt;1.7.1&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
		
			&lt;!-- So we can specify YaaS client details also from mvn command line, for CI --&gt;
			&lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.12.4&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;systemPropertyVariables&gt;
                        &lt;yaaSClientsIdentifierFromCLI&gt;${yaaSClientsIdentifier}&lt;/yaaSClientsIdentifierFromCLI&gt;
                        &lt;yaaSClientsClient_IDFromCLI&gt;${yaaSClientsClient_ID}&lt;/yaaSClientsClient_IDFromCLI&gt;
                        &lt;yaaSClientsClient_SecretFromCLI&gt;${yaaSClientsClient_Secret}&lt;/yaaSClientsClient_SecretFromCLI&gt;
                    &lt;/systemPropertyVariables&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;                
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;



&lt;/project&gt;
  



    

 </pre></code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/CallingYaaSServiceException.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/CallingYaaSServiceException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites.exceptions;

public class CallingYaaSServiceException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/InsufficientScopesException.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/InsufficientScopesException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites.exceptions;

public class InsufficientScopesException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/NoTenantException.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/exceptions/NoTenantException.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites.exceptions;

public class NoTenantException extends RuntimeException {

}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/StringUtils.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/StringUtils.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.apache.commons.lang3.StringUtils.lowerCase;

/**
 * Created by d066419 on 04/07/16.
 */
public class StringUtils {
    private StringUtils() {
    }

    static String restrictThenLowercase(String string) {
        return lowerCase(restrictLength(string));
    }


    static String restrictLength(String string) {
        return string == null ? null : string.substring(0, Math.min(string.length(), 200));
    }
}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/DocuServiceWrapper.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/DocuServiceWrapper.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites.subscriptions;

import java.util.Map;
import java.util.Optional;

import javax.annotation.ManagedBean;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.PropertySource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.web.client.RestClientException;
import org.springframework.web.client.RestTemplate;

import com.google.gson.Gson;
import com.hybris.yaas.bites.Tip;
import com.hybris.yaas.bites.exceptions.CallingYaaSServiceException;

@ManagedBean
@PropertySource("classpath:application.properties")
public class DocuServiceWrapper {

    private static final Logger LOGGER = LoggerFactory.getLogger(DocuServiceWrapper.class);

    @Value("${docuRepoURL}")
    private String URI;
    @Value("${projectIDAkaTenant}")
    private String tenant;
    @Value("${yaaSClientsIdentifier}")
    private String appId;
    @Value("${docuRepoType}")
    private String type;
    @Value("${yaaSClientsClient_ID}")
    private String yaaSClientsClient_ID;
    @Value("${yaaSClientsClient_Secret}")
    private String yaaSClientsClient_Secret;
    @Value("${docuRepoScopes}")
    private String scopes;

    @Autowired
    private OAuthWrapper oaw;


    public DocuServiceWrapper() {
    }

    public DocuServiceWrapper tenant(String tenant) {
        this.tenant = tenant;
        return this;
    }

    public DocuServiceWrapper appId(String appId) {
        this.appId = appId;
        return this;
    }

    public String post(Tip t) {
        try {
            String token = getTokenForServiceToCallDocuRepoOnBehalfOfProject();
            String url = URI + "/" + tenant + "/" + appId + "/data/" + type;
            HttpEntity<String> request = new HttpEntity<>(toJson(t), headerWithToken(token));
            Map<String, String> map = new RestTemplate().postForObject(url, request, Map.class);
            if (map != null && map.containsKey("link"))
                return map.get("link");
        } catch (RestClientException e) {
            e.printStackTrace();
            if (e.getMessage().contains("Conflict"))
                return "Conflict";
        }
        throw new CallingYaaSServiceException();
    }

    public Optional<Tip> get(String id) {
        try {
            String token = getTokenForServiceToCallDocuRepoOnBehalfOfProject();
            HttpEntity<String> request = new HttpEntity<>(headerWithToken(token));
            String url = geturl4TipId(id);
            Tip tip = new RestTemplate().exchange(url, HttpMethod.GET, request, Tip.class).getBody();
            return Optional.of(tip);
        } catch (RestClientException e) {
            e.printStackTrace();
        }
        throw new CallingYaaSServiceException();
    }

    public Tip[] get() {
        try {
            String token = getTokenForServiceToCallDocuRepoOnBehalfOfProject();
            HttpEntity<String> request = new HttpEntity<>(headerWithToken(token));
            String url = URI + "/" + tenant + "/" + appId + "/data/" + type;
            Tip[] tips = new RestTemplate().exchange(url, HttpMethod.GET, request, Tip[].class).getBody();
            return tips;
        } catch (RestClientException e) {
            e.printStackTrace();
            throw new CallingYaaSServiceException();
        }
    }

    public String put(Tip t) {
        try {
            String token = getTokenForServiceToCallDocuRepoOnBehalfOfProject();
            String id = t.getId();
            String url = geturl4TipId(id);
            LOGGER.debug("put url is [{}]", url);
            HttpEntity<String> request = new HttpEntity<>(toJson(t), headerWithToken(token));
            new RestTemplate().put(url, request);
            return url;
        } catch (RestClientException e) {
            e.printStackTrace();
            if (e.getMessage().contains("Conflict"))
                return "Conflict";
        }
        throw new CallingYaaSServiceException();
    }

    private String geturl4TipId(String id) {
        return URI + "/" + tenant + "/" + appId + "/data/" + type + "/" + id;
    }

    public HttpStatus delete(String id) {
        try {
            String token = getTokenForServiceToCallDocuRepoOnBehalfOfProject();
            String url = geturl4TipId(id);
            HttpEntity<String> request = new HttpEntity<>(headerWithToken(token));
            Object o = new RestTemplate().exchange(url, HttpMethod.DELETE, request, Object.class).getBody();
            return HttpStatus.OK;
        } catch (RestClientException e) {
            e.printStackTrace();
            return HttpStatus.NOT_MODIFIED;
        }
    }

    public HttpStatus deleteAll() {
        try {
            String token = getTokenForServiceToCallDocuRepoOnBehalfOfProject();
            String url = URI + "/" + tenant + "/" + appId;
            HttpEntity<Object> request = new HttpEntity<>(headerWithToken(token));
            new RestTemplate().exchange(url, HttpMethod.DELETE, request, Object.class).getBody();
            return HttpStatus.OK;
        } catch (RestClientException e) {
            e.printStackTrace();
            return HttpStatus.NOT_MODIFIED;
        }
    }

    private HttpHeaders headerWithToken(String token) {
        HttpHeaders headers = new HttpHeaders();
        headers.add("content-type", "application/json");
        headers.add("Authorization", "Bearer " + token);
        return headers;
    }

    private String toJson(Object o) {
        return new Gson().toJson(o);
    }

    private String getTokenForServiceToCallDocuRepoOnBehalfOfProject() {
        Map<String, String> tokenMap = oaw.getToken().orElse(null);
        if (tokenMap == null)
            throw new CallingYaaSServiceException();
        return tokenMap.get("access_token");
    }

	public String getAppId() {
		return appId;
	}

	public void setAppId(String appId) {
		this.appId = appId;
	}

	public String getYaaSClientsClient_ID() {
		return yaaSClientsClient_ID;
	}

	public void setYaaSClientsClient_ID(String yaaSClientsClient_ID) {
		this.yaaSClientsClient_ID = yaaSClientsClient_ID;
	}

	public String getYaaSClientsClient_Secret() {
		return yaaSClientsClient_Secret;
	}

	public void setYaaSClientsClient_Secret(String yaaSClientsClient_Secret) {
		this.yaaSClientsClient_Secret = yaaSClientsClient_Secret;
	}
}

</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/OAuthWrapper.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/OAuthWrapper.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites.subscriptions;

import java.util.Map;
import java.util.Optional;

import javax.annotation.ManagedBean;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.PropertySource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.web.client.RestClientException;
import org.springframework.web.client.RestTemplate;

import com.hybris.yaas.bites.exceptions.CallingYaaSServiceException;

@ManagedBean
@PropertySource("classpath:application.properties")
public class OAuthWrapper { 

	@Value("${oauthURL}")
	private String URI;
	@Value("${projectIDAkaTenant}")
    private String tenant; 
	@Value("${yaaSClientsIdentifier}")
    private String appId;
	@Value("${docuRepoType}")
    private String type;
	@Value("${yaaSClientsClient_ID}")
	private String clientId;
	@Value("${yaaSClientsClient_Secret}")
	private String clientSecret;
	@Value("${docuRepoScopes}")	
	private String scopes;
	
    private String grantType = "client_credentials";
    
    public OAuthWrapper( ){
    }
    
    public OAuthWrapper grantType( String grantType ){
    	this.grantType = grantType;
    	return this;
    }
    public OAuthWrapper clientId( String clientId ){
    	this.clientId = clientId;
    	return this;
    }
    public OAuthWrapper clientSecret( String clientSecret ){
    	this.clientSecret = clientSecret;
    	return this;
    }
    public OAuthWrapper tenant( String tenant ){
    	this.tenant = tenant;
    	return this;
    }   
    public OAuthWrapper scope( String scope ){
    	this.scopes = scope;
    	return this;
    }   
    public OAuthWrapper build(  ){
    	this.scopes = "hybris.tenant"+"="+tenant+" "+scopes; 	
    	return this;
    }
    
    public Optional<Map<String,String>> getToken(){   	
    	try {
			HttpHeaders headers = new HttpHeaders();   	
			headers.add("content-type", "application/x-www-form-urlencoded" );  	
			RestTemplate restTemplate = new RestTemplate();
			String body = 
					"grant_type="+grantType+
					"&client_id="+clientId+
					"&client_secret="+clientSecret+
					"&scope="+scopes;
			HttpEntity<Object> request = new HttpEntity<>( body, headers );
			Map<String,String> tokenMap = restTemplate.postForObject(URI, request, Map.class );  			
			return Optional.of(tokenMap);
		} catch (RestClientException e) {
			throw new CallingYaaSServiceException();
		}
    }

	public String getAppId() {
		return appId;
	}

	public void setAppId(String appId) {
		this.appId = appId;
	}

	public String getClientId() {
		return clientId;
	}

	public void setClientId(String clientId) {
		this.clientId = clientId;
	}

	public String getClientSecret() {
		return clientSecret;
	}

	public void setClientSecret(String clientSecret) {
		this.clientSecret = clientSecret;
	} 	
}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/TipsDocuRepo.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/subscriptions/TipsDocuRepo.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites.subscriptions;

import java.util.Arrays;
import java.util.List;
import java.util.Optional;

import javax.annotation.ManagedBean;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.PropertySource;

import com.hybris.yaas.bites.Tip;

@PropertySource("classpath:application.properties")
@ManagedBean
public class TipsDocuRepo {

    @Autowired
    private DocuServiceWrapper dsw;

    public List<Tip> findByTenant(String tenant) {
        Tip[] tips = dsw.get();
        return Arrays.asList(tips);
    }

    public String post(Tip t) {
        return dsw.post(t);
    }

    public String put(Tip t) {
        return dsw.put(t);
    }

    public void delete(String id) {
        dsw.delete(id);
    }

    public void deleteAll() {
        dsw.deleteAll();
    }

    public boolean exists(String id) {
        return dsw.get(id).isPresent();
    }

    public Optional<Tip> findOne(String id) {
        return dsw.get(id);

    }
}</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Tip.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/Tip.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import java.util.Objects;

import static com.hybris.yaas.bites.StringUtils.restrictLength;
import static com.hybris.yaas.bites.StringUtils.restrictThenLowercase;

@Entity
public class Tip {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private String id;  // See JIRA  https://jira.hybris.com/browse/FROG-3800 - the id must be a string instead of a long

    private String tenant;

    private String tip;

    public Tip() {
    }

    public Tip(String id, String tip, String tenant) {
        this.id = id;
        this.tip = restrictLength(tip);
        this.tenant = restrictThenLowercase(tenant);
    }

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public void setTip(String tip) {
        this.tip = restrictLength(tip);
    }

    public String getTip() {
        return tip;
    }

    public String getTenant() {
        return tenant;
    }

    public void setTenant(String tenant) {
        this.tenant = restrictThenLowercase(tenant);
    }

    public String toString() {
        return "Tip[ Id: " + id + " Tip: " + tip + " Tenant: " + tenant + "]\n";
    }

    @Override
    public int hashCode() {
        return Objects.hash(id, tenant, tip);
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Tip tip1 = (Tip) o;
        return Objects.equals(id, tip1.id) &&
                Objects.equals(tenant, tip1.tenant) &&
                Objects.equals(tip, tip1.tip);
    }

}
</code></pre>File: <b id='essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/TipController.java'/>essentials/yaasbite800/src/main/java/com/hybris/yaas/bites/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;
import org.springframework.http.HttpHeaders;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.hybris.yaas.bites.exceptions.CallingYaaSServiceException;
import com.hybris.yaas.bites.exceptions.InsufficientScopesException;
import com.hybris.yaas.bites.exceptions.NoTenantException;
import com.hybris.yaas.bites.subscriptions.TipsDocuRepo;

@RestController
public class TipController {

    private final Logger LOG = LoggerFactory.getLogger(TipController.class);

    @Autowired
    private TipsDocuRepo repo;

    @CrossOrigin()
    @RequestMapping(value = "{tenantFromURL}/ping", method = RequestMethod.GET)
    public ResponseEntity<String> ping(
            @RequestHeader(value = "hybris-tenant", defaultValue = "") String tenantFromHeader,
            @RequestHeader(value = "hybris-scopes", defaultValue = "") String scopesFromHeader,
            @PathVariable String tenantFromURL
    ) {

        String s = "-> In GET " + tenantFromURL + "/ping: " +
                "  tenantFromURLPath: '" + tenantFromURL +
                "',   hybris-tenant from token: '" + tenantFromHeader +
                "',   hybris-scopes from token: '" + scopesFromHeader + "'";
        LOG.debug(s);

        return new ResponseEntity<>(s, HttpStatus.OK);
    }

    @CrossOrigin()
    @RequestMapping(value = "{tenantFromURL}/tips", method = RequestMethod.DELETE)
    public ResponseEntity<String> deleteAllOfOneTenant(@RequestHeader(value = "hybris-tenant") String tenant) {
        LOG.debug("-> In DELETE /tips Tenant: " + tenant);
        if (tenant == null)
            throw new NoTenantException();
        repo.deleteAll();
        return new ResponseEntity<String>("{}", HttpStatus.OK);
    }

    @CrossOrigin()
    @RequestMapping(value = "{tenantFromURL}/tips", method = RequestMethod.GET)
    public ResponseEntity<List<Tip>> getAllTips(@RequestHeader(value = "hybris-tenant") String tenant) {
        LOG.debug("-> In GET /tips Tenant: " + tenant);
        if (tenant == null)
            throw new NoTenantException();
        return new ResponseEntity<>(repo.findByTenant(tenant), HttpStatus.OK);
    }

    @CrossOrigin()
    @RequestMapping(value = "{tenantFromURL}/tips", method = RequestMethod.POST)
    public ResponseEntity<Void> postTip(
            @RequestHeader(value = "hybris-tenant") String tenant,
            @RequestBody Tip tip, UriComponentsBuilder ucBuilder) {
        LOG.debug("-> In POST /tips Tenant: " + tenant);
        if (tenant == null)
            throw new NoTenantException();
        tip.setTenant(tenant);
        repo.post(tip);

        HttpHeaders newHeaders = new HttpHeaders();
        newHeaders.setLocation(ucBuilder.path("/tips/{id}").buildAndExpand(tip.getId()).toUri());
        return new ResponseEntity<Void>(newHeaders, HttpStatus.CREATED);
    }

    @CrossOrigin()
    @RequestMapping(value = "{tenantFromURL}/tips/{id}", method = RequestMethod.PUT)
    public ResponseEntity<String> putTip(
            @RequestHeader(value = "hybris-tenant") String tenant,
            @RequestHeader(value = "hybris-scopes") String scopes,
            @PathVariable String id, @RequestBody Tip t) {
        LOG.debug("-> In PUT /tips  Tenant: {} with scopes {}", tenant, scopes);
        if (tenant == null)
            throw new NoTenantException();
        if (scopes == null || !scopes.contains("hybris.yaasbites-scopetwo"))
            throw new InsufficientScopesException();
        t.setTenant(tenant);

        synchronized (repo) {
            //if (repo.exists(id)){
            Optional<Tip> oldTip = repo.findOne(id);
            if (oldTip.isPresent()) {
                oldTip.get().setTip(t.getTip());
                repo.put(oldTip.get());
                return new ResponseEntity<String>(HttpStatus.OK);
            }
        }
        return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{'message':'Tip '+id+' not found'}");
    }

    @CrossOrigin()
    @RequestMapping(value = "{tenantFromURL}/tips/{id}", method = RequestMethod.DELETE)
    public ResponseEntity<String> deleteTip(
            @RequestHeader(value = "hybris-tenant") String tenant,
            @PathVariable String id) {
        LOG.debug("-> In DELETE /tips  Tenant: " + tenant);
        if (tenant == null)
            throw new NoTenantException();

        synchronized (repo) {
            Optional<Tip> oldTip = repo.findOne(id);
            if (oldTip.isPresent() && oldTip.get().getTenant().equals(tenant)) {
                repo.delete(id);
                return new ResponseEntity<String>(HttpStatus.NO_CONTENT);
            }
        }
        return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body("{'message':'Tip '+id+'not found'}");
    }

    // Convert exception to an HTTP Status code
    @ResponseStatus(value = HttpStatus.BAD_REQUEST, reason = "No Tenant Defined")  // 400
    @ExceptionHandler(NoTenantException.class)
    public void anyName() {
    }

    // Convert exception to an HTTP Status code
    @ResponseStatus(value = HttpStatus.BAD_REQUEST, reason = "Missing expected scope: hybris.yaasbites-scopetwo")
    // 400
    @ExceptionHandler(InsufficientScopesException.class)
    public void anyOtherName() {
    }

    // Convert exception to an HTTP Status code
    @ResponseStatus(value = HttpStatus.BAD_REQUEST, reason = "Something went wrong calling a subscribed service")
    // 400
    @ExceptionHandler(CallingYaaSServiceException.class)
    public void andAnyOtherName() {
    }

}
</code></pre>File: <b id='essentials/yaasbite800/src/main/webapp/index.html'/>essentials/yaasbite800/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;
&lt;script&gt;

function entryWithEquals(str) {
	return str.includes("=")
}
function entryWithoutEquals(str) {
	return !str.includes("=")
}
var app = angular.module('tipsApp', ['restangular']);

app.config(function(RestangularProvider) {
	var location = window.location.href.replace("/#", "");
	location = location.replace("index.html", "");
	RestangularProvider.setBaseUrl(location);
});

app.controller('tipsController', function($scope, Restangular, $http ) {

	$scope.SERVICES_API_PROXY="https://api.yaas.io/gauravonboarding/gauravyaasbite8/v1" // NEEDS_ADJUSTING TO YOUR API_PROXY ADDRESS, BUT KEEP THE HTTPS PROTOCOL
	$scope.OAUTH_URL = "https://api.yaas.io/hybris/oauth2/v1/token"
	$scope.CLIENT_ID = "hbwDr7dNMBT2Vnidhli6eedtUZvOoygq"; // NEEDS_ADJUSTING TO THE CLIENT_ID OF YOUR CLIENT AND...
	// NEEDS ADJUSTING - YOU MUST ADD THE VALUE OF $scope.SERVICES_API_PROXY TO THE REDIRECTURLS LISTING IN YOUR YAAS CLIENT - something like https://api.yaas.io/gauravonboarding/gauravyaasbite8/v1
	$scope.loggingIn = function() {

		var location = window.location.href.replace("/#", "").replace("index.html", "");

		if (location.indexOf("access_token=")==-1){ // The first time to this page, we will not have access_token in the URL
		    // Redirect to Yaas' OAuth2 endpoint, passing this page as the redirect_uri so that we come back to this page afterwards
			var target =  "https://api.yaas.io/hybris/oauth2/v1/authorize" +
			"?response_type=token"+
			"&scope=hybris.tips_vip hybris.yaasbites-scopetwo"+
			"&client_id="+ $scope.CLIENT_ID +
			"&redirect_uri="+ $scope.SERVICES_API_PROXY;
		    window.open(target );
		    //=================
		}
		else {
			// If this URL does contain "access_token" it means we have already been redirected back to this page from Yaas' oauth2 service
			location = location.substring(location.indexOf( "access_token=" ) + "access_token=".length);
			$scope.token = location.substring(0, location.indexOf("&"));
			$scope.analyzeToken();
		}
	}

	$scope.setBaseUrl = function(){
		console.log("IN SETBASEURL WITH "+$scope.SERVICES_API_PROXY)
		Restangular.setBaseUrl($scope.SERVICES_API_PROXY+"/"+$scope.tenantName);
	}

	$scope.getReadyToCall = function( restangular ){
		$scope.responseData=null
		$scope.errorMessage=null
		$scope.setBaseUrl();
		restangular.setDefaultHeaders({Authorization:'Bearer '+ $scope.token});

	}

	$scope.ping = function(){
		if(!$scope.validateTenantName(false))
    		return;

		$scope.getReadyToCall(Restangular, true)
		Restangular.one("ping").get().then(
			function(data) {
				$scope.responseData = data.toString(); //Restangular.stripRestangular(data)
			},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}
	$scope.getAllTips = function(){
		$scope.getReadyToCall(Restangular, false)
		Restangular.all("tips").getList().then(
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

	$scope.getTips = function(){
		$scope.getReadyToCall(Restangular, true)
		if(!$scope.validateTenantName(false))
    		return;

		Restangular.all("tips").getList().then(
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

	$scope.sensitiveMethodForVIPsOnly = function(){
		$scope.getReadyToCall(Restangular, false)
		Restangular.all("tips").remove().then(
			function(data) {
				$scope.responseData = Restangular.stripRestangular(data)
			},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

    $scope.postTip = function(){
		$scope.getReadyToCall(Restangular, true)
		if(!$scope.validateTenantName(false) || !$scope.validateText(true))
			return;
		var json = { 'tip': ''+$scope.tipText }
		Restangular.all("tips").post(json).then(
			function(data) {
    			$scope.getTips()
	    	},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

    $scope.putTip = function(){
		$scope.getReadyToCall(Restangular, true)
		if(!$scope.validateTenantName(false) || !$scope.validateId(true) || !$scope.validateText(false) )
			return;
    	var json = { 'tip': ''+$scope.tipText }
    	Restangular.one("tips/"+$scope.tipId).customPUT(json).then(
    		function(data) {
				$scope.getTips()
    		},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

    $scope.deleteTip = function(){
		$scope.getReadyToCall(Restangular, true)
		if(!$scope.validateTenantName(false) || !$scope.validateId(true))
			return;
    	Restangular.one("tips/"+$scope.tipId).remove().then(
    		function(data) {
    			$scope.getTips()
        	},
			function(response) {
				$scope.errorMessage = response.status + ' '+response.data.message;
		  	}
		);
	}

	$scope.validateText = function(clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipText)
			return true;
		$scope.errorMessage = "Woops, no Tip Text has been given";
		return false;
	}

	$scope.validateId = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tipId)
			return true;
		$scope.errorMessage = "Woops, the ID is empty or invalid";
		return false;
	}

	$scope.analyzeToken = function(){
		$scope.responseData=null
		$scope.errorMessage=null
		$http({
			url : 'https://api.yaas.io/hybris/echo/v1/get',
			method : 'GET',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded',
				'Authorization':'Bearer '+$scope.token}
		}).success(function(data, status, headers, config) {
			$scope.tokenDetails = data['hybris-scopes']
			$scope.tokenDetailsTenant = data['hybris-scopes'].split(" ").filter( entryWithEquals )[0].replace("hybris.tenant=","");
			$scope.tokenDetailsScopes = data['hybris-scopes'].split(" ").filter( entryWithoutEquals ).toString();
		}).error(function(data, status, headers, config) {
			$scope.errorMessage = "ERROR in Analyzing token: "+ data
		});
	}

	$scope.validateTenantName = function( clearMsg){
		if(clearMsg)
			$scope.errorMessage = ""
		if ($scope.tenantName)
			return true;
		$scope.errorMessage = "Woops, please provide a name for the Tenant field, eg. Adidas, or Nike, ..";
		return false;
	}

	$scope.token = null;
	$scope.includeToken='NO'
	$scope.serverLocation='local'
	$scope.getReadyToCall(Restangular)
	$scope.tenantName='ADIDAS'
});

&lt;/script&gt;

&lt;body  ng-app=tipsApp ng-controller="tipsController" ng-init="loggingIn()" &gt;

&lt;h2&gt;YaaS Bite 8: Adidas Tenant&lt;/h2&gt;

	A client-front-end, reached after logging-in with the Implicit Grant Flow.&lt;br&gt;

	&lt;div ng-show="token"&gt;
		&lt;h3&gt;Token returned:&lt;/h3&gt;
		Token Value: {{token}}&lt;br&gt;
		Token Tenant (on whose behalf are these calls being made): {{tokenDetailsTenant}}&lt;br&gt;
		Token Scopes (which special permissions does this token have): {{tokenDetailsScopes}}&lt;br&gt;

		&lt;h3&gt;Make REST calls to Tips Service&lt;/h3&gt;
		Include Token in headers to Tips webservice?
		Yes &lt;input ng-disabled="!token" type="radio" ng-model="includeToken" value=YES &gt;
		No &lt;input ng-disabled="!token" type="radio" ng-model="includeToken " value=NO  &gt;		&lt;br&gt;&lt;br&gt;

		Tenant name: {{tenantName}}&lt;br&gt;
		Ping the service @ &lt;a href="#" ng-click="ping()"&gt;{{tenantName}}/ping&lt;/a&gt;&lt;br&gt;
		Get tips for tenant {{tenantName}} &lt;a href="#" ng-click="getTips()"&gt;Call GET {{tenantName}}/tips&lt;/a&gt;&lt;br&gt;
		Post tip for tenant {{tenantName}} &lt;a href="#" ng-click="postTip()"&gt;Call POST {{tenantName}}/tips&lt;/a&gt; with "{ 'tip': ' &lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Adjust tip for tenant {{tenantName}} &lt;a href="#" ng-click="putTip()"&gt;Call PUT {{tenantName}}/tips/&lt;/a&gt; &lt;input name=tipId ng-model="tipId"/&gt; with "{ 'tip': '&lt;input name=tipText ng-model="tipText"/&gt;' }"&lt;br&gt;
		Delete tip for tenant {{tenantName}} &lt;a href="#" ng-click="deleteTip()"&gt;Call DELETE {{tenantName}}/tips&lt;/a&gt; &lt;input name=tipId ng-model="tipId" /&gt; &lt;br&gt;
		Get all tips from all tenants: &lt;/b&gt;&lt;a href="#" ng-click="getAllTips()"&gt;Call GET /tips&lt;/a&gt;&lt;br&gt;
		Invoke sensitiveMethodForVIPsOnly: &lt;/b&gt;&lt;a href="#" ng-click="sensitiveMethodForVIPsOnly()"&gt;Call DELETE /tips&lt;/a&gt; (Requires scope hybris.tips_vip)&lt;br&gt;

		&lt;h3 ng-show="responseData!=null"&gt;Response:&lt;/h3&gt;&lt;div style="color:green" ng-show="responseData!=null"&gt;{{responseData|json}}&lt;/div&gt;
	&lt;/div&gt;
	&lt;p style="color:red" ng-show="errorMessage"&gt;{{errorMessage|json}}&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite800/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite800/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

    
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite800/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbite800/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

import java.util.Arrays;
import java.util.Map;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.TestRestTemplate;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.context.annotation.PropertySource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.hybris.yaas.bites.subscriptions.DocuServiceWrapper;
import com.hybris.yaas.bites.subscriptions.OAuthWrapper;

@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")
@PropertySource("classpath:application.properties")

public class SanityTest {

    private final String LOCALENDPOINT = "http://localhost:8080/testTenant/tips";

    @Value("${projectIDAkaTenant}")
    private String TENANT;
    @Value("${docuRepoURL}")
    private String docuRepoURI;
    @Value("${yaaSClientsIdentifier}")
    private String appId;
    @Value("${docuRepoType}")
    private String type;
    @Value("${yaaSClientsClient_ID}")
    private String yaaSClientsClient_ID;
    @Value("${yaaSClientsClient_Secret}")
    private String yaaSClientsClient_Secret;
    @Value("${docuRepoScopes}")
    private String scopes;

    @Autowired
    private OAuthWrapper oaw;
    @Autowired
    private DocuServiceWrapper dsw;

    private HttpHeaders headersWithJustTenant;
    private HttpHeaders headersWithTenantAndScope;
    private final TestRestTemplate restTemplate = new TestRestTemplate();
    private HttpEntity<Tip> emptyEntityWithTenantHeader;

    @Before
    public void setUpTenantInHeadaer() {
    	
    	if (System.getProperty("yaaSClientsIdentifierFromCLI")!=null){
    		appId=System.getProperty("yaaSClientsIdentifierFromCLI");
    		oaw.setAppId(appId);
    		dsw.setAppId(appId);
    	}
    	if (System.getProperty("yaaSClientsClient_IDFromCLI")!=null){
    		yaaSClientsClient_ID=System.getProperty("yaaSClientsClient_IDFromCLI");
    		oaw.setClientId(yaaSClientsClient_ID);
    		dsw.setYaaSClientsClient_ID(yaaSClientsClient_ID);
    	}
    	if (System.getProperty("yaaSClientsClient_SecretFromCLI")!=null){
    		yaaSClientsClient_Secret=System.getProperty("yaaSClientsClient_SecretFromCLI");
       		oaw.setClientSecret(yaaSClientsClient_Secret);
       		dsw.setYaaSClientsClient_Secret(yaaSClientsClient_Secret);
       	  }
    	    	
        headersWithJustTenant = new HttpHeaders();
        headersWithJustTenant.add("hybris-tenant", TENANT);
        headersWithTenantAndScope = new HttpHeaders();
        headersWithTenantAndScope.add("hybris-tenant", TENANT);
        headersWithTenantAndScope.add("hybris-scopes", "hybris.yaasbites-scopetwo");
        emptyEntityWithTenantHeader = new HttpEntity<Tip>(headersWithJustTenant);
    }

    //@Test(timeout = 10000)
    @Test
    public void siteIsAwakeAndWorking() throws Exception {

        Object o = restTemplate.exchange(LOCALENDPOINT, HttpMethod.DELETE, emptyEntityWithTenantHeader, Object.class).getBody();
        assertTrue(o != null);

        assertTips("no tips initially present");

        Tip newTip = new Tip("1", "Hello World!", TENANT);
        restTemplate.postForEntity(LOCALENDPOINT, new HttpEntity<Tip>(newTip, headersWithJustTenant), Object.class);
        assertTips("tip should get created", newTip);

        Tip newTip2 = new Tip("2", "Hello World!", TENANT);
        restTemplate.postForEntity(LOCALENDPOINT, new HttpEntity<Tip>(newTip2, headersWithJustTenant), Object.class);
        assertTips("tip should get created", newTip, newTip2);
        restTemplate.exchange(LOCALENDPOINT + "/" + newTip2.getId(), HttpMethod.DELETE, emptyEntityWithTenantHeader, String.class);
        assertTips("one tip after deleting second tip", newTip);

        Tip updatedTip = new Tip("1", "Updated tip", TENANT);
        restTemplate.put(LOCALENDPOINT + "/1", new HttpEntity<>(updatedTip, headersWithJustTenant));
        assertTips("tip should not get updated with just tenant in the header but no scope", newTip);

        restTemplate.put(LOCALENDPOINT + "/1", new HttpEntity<Tip>(updatedTip, headersWithTenantAndScope));
        assertTips("tip should get updated", updatedTip);

        restTemplate.exchange(LOCALENDPOINT + "/" + newTip.getId(), HttpMethod.DELETE, emptyEntityWithTenantHeader, String.class);
        assertTips("no tips after delete");
    }

    private void assertTips(String message, Tip... expected) {
        assertArrayEquals(message,
                expected, restTemplate.exchange(LOCALENDPOINT, HttpMethod.GET, emptyEntityWithTenantHeader, Tip[].class).getBody()
        );
    }

    @Test
    public void callingDocuRepoOnBehalfOfProject() {

        Map<String, String> tokenMap = oaw.getToken().orElse(null);
        String token = tokenMap.get("access_token");
        assertTrue(token != null);
        String allocatedScopes = tokenMap.get("scope");

        assertTrue(allocatedScopes.contains(scopes));

        String url = dsw.post(new Tip("1", "Hello World!", TENANT));
        assertTrue(
                url.contains(docuRepoURI) ||
                        url.contains("Conflict")
        );
    }

}
</code></pre>File: <b id='essentials/yaasbite900/pom.xml'/>essentials/yaasbite900/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbite9&lt;/artifactId&gt;
	&lt;name&gt;yaasbite9&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;
			&lt;version&gt;1.1.0.RELEASE&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;
		
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
</pre></code></pre>File: <b id='essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipController.java'/>essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipController.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.time.Duration;
import java.time.Instant;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

// Example of Hystrix in action - the  @EnableCircuitBreaker annotation enables hystrix protection.  
// See https://spring.io/guides/gs/circuit-breaker/ and https://www.javacodegeeks.com/2014/09/defend-your-application-with-hystrix.html for examples.
@EnableCircuitBreaker
@RestController
public class TipController {
    
	private final Logger LOG = LoggerFactory.getLogger(TipController.class);

	@Autowired
	private TipService tipService;
	 
	// Nothing special - standard Ping for sanity tests
	@CrossOrigin() 
    @RequestMapping( value="/ping", method=RequestMethod.GET )
    public ResponseEntity<String> ping( ) {   	 
    	String s= "-> In GET /ping";
    	LOG.debug(s);
    	return new ResponseEntity<String>(s, HttpStatus.OK); 
    }
	
	// This calls tipService.riskyMethod which *may* take unacceptably long to respond,  if TipService has a problem
    @CrossOrigin() 
    @RequestMapping( value="/riskyConnection", method=RequestMethod.GET )
    public ResponseEntity<String> riskyConnection( ) throws InterruptedException{
    	String s= "-> In GET /riskyConnection ";
    	LOG.debug(s);
    	
    	Instant t1 = Instant.now();
    	s += tipService.riskyMethod( );
    	Instant t2 = Instant.now();
    	s +=" Time taken: "+Duration.between(t1, t2).toMillis() +"ms";
    	
    	return new ResponseEntity<String>(s, HttpStatus.OK); 
    }
    
	// This calls tipService.riskyMethod which *may* take unacceptably long to respond, if TipService has a problem
    @CrossOrigin() 
    @RequestMapping( value="/veryRiskyConnection", method=RequestMethod.GET )
    public ResponseEntity<String> veryRiskyConnection( ) throws InterruptedException{
    	String s= "-> In GET /veryRiskyConnection ";
    	LOG.debug(s);
    	
    	Instant t1 = Instant.now();
    	s += tipService.veryRiskyMethod( );
    	Instant t2 = Instant.now();
    	s +=" Time taken: "+Duration.between(t1, t2).toMillis() +"ms";
    	
    	return new ResponseEntity<String>(s, HttpStatus.OK); 
    }
    
    // Toggle the problem in TipService
    @CrossOrigin() 
    @RequestMapping( value="/toggleProblem", method=RequestMethod.GET )
    public ResponseEntity<String> toggleProblem( ) throws InterruptedException{
    	String s = "-> In GET /toggleProblem ";
    	LOG.debug(s);
    	tipService.toggleProblem( );
    	s+= "Problems="+ tipService.hasProblem();    	
    	return new ResponseEntity<String>(s, HttpStatus.OK); 
    }  
	
}</code></pre>File: <b id='essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipService.java'/>essentials/yaasbite900/src/main/java/com/hybris/yaas/bites/TipService.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Service;

import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;
		
@Service
public class TipService {
    
	private final Logger LOG = LoggerFactory.getLogger(TipService.class);
   
    private static boolean problem = false;   
    public static final int GOOD_USER_EXPERIENCE_SLEEP_MS = 1000;
    public static final int BAD_USER_EXPERIENCE_SLEEP_MS = 15000;
	private static final int HYSTRIX_TRIGGER_MS =2000 ;   
    
	
	// Supply Hystrix with a fallback method to invoke, should this method be taking too long
	@HystrixCommand(fallbackMethod = "fallBackMethod",
    		commandProperties = {
    			@HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = ""+HYSTRIX_TRIGGER_MS)
    })
	public String riskyMethod(  ) throws InterruptedException{   	
		// If there is a problem, this method will take too long, but is protected by Hystrix
    	if (problem){
        	LOG.debug("RiskyMethod is not responding promptly, about to have a BAD pause");
    		Thread.sleep(BAD_USER_EXPERIENCE_SLEEP_MS);
    	}
    	LOG.debug("In riskyMethod");
		return "Returning from riskyMethod";
    }
    
	// If there is a problem, this method will take too long
    public String veryRiskyMethod(  ) throws InterruptedException{   	
    	if (problem){
        	LOG.debug("RiskyMethod is not responding promptly, about to have a BAD pause");
    		Thread.sleep(BAD_USER_EXPERIENCE_SLEEP_MS);
    	}
    	LOG.debug("In veryRiskyMethod");
		return "Returning from veryRiskyMethod";
    }
    
    public String fallBackMethod(  ) {   
    	LOG.info("In fallBackMethod");
		return "Returning from fallBackMethod";
    }
    
    public void toggleProblem(  ) {   	
    	problem=!problem;
    }

    public boolean hasProblem(){
    	return problem;
    }
}
</code></pre>File: <b id='essentials/yaasbite900/src/main/webapp/index.html'/>essentials/yaasbite900/src/main/webapp/index.html</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link rel="stylesheet" type="text/css" href="mycss.css"&gt;
&lt;/head&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/underscore/underscore.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/angular/angular.js"&gt;	&lt;/script&gt;
&lt;script src="https://builder.yaas.io/public/js/vendor/restangular/dist/restangular.js"&gt;	&lt;/script&gt;		
&lt;script&gt;

var app = angular.module('tipsApp', ['restangular']);

app.controller('tipsController', function($scope, Restangular, $http ) {		
	
	$scope.getReadyToCall = function( restangular ){
		restangular.setDefaultHeaders({});		
	}
	
	$scope.ping = function(){
		$scope.getReadyToCall(Restangular )	
		Restangular.one("ping").get().then(		
			function(data) {
				$scope.responseData.push(  data.toString() ); 
			}, 	
			function(response) {
				$scope.errorMessage = response.data.message;
		  	}
		);
	}
	
	$scope.riskyConnection = function(){
		$scope.getReadyToCall(Restangular )	
		Restangular.one("riskyConnection").get().then(		
			function(data) {
				$scope.responseData.push(  data.toString() ); 
			}, 
			function(response) {
				$scope.errorMessage = response.data.message;
		  	}
		);
	}
		
	$scope.veryRiskyConnection = function(){
		$scope.getReadyToCall(Restangular )	
		Restangular.one("veryRiskyConnection").get().then(		
			function(data) {
				$scope.responseData.push(  data.toString() ); 
			}, 
			function(response) {
				$scope.errorMessage = response.data.message;
		  	}
		);
	}
	
	$scope.toggleProblem = function(){
		$scope.getReadyToCall(Restangular )	
		Restangular.one("toggleProblem").get().then(		
			function(data) {
				$scope.responseData.push(  data.toString() ); 
				$scope.problem =  data.toString().indexOf("true")&gt;-1;
			}, 
			function(response) {
				$scope.errorMessage = response.data.message;
		  	}
		);
	}
	
	$scope.problem = false;
	$scope.responseData=[]
	$scope.errorMessage=''
});

&lt;/script&gt;

&lt;body  ng-app=tipsApp ng-controller="tipsController" &gt;

&lt;h2&gt;YaaS Bite: Handling risky connections with Hystrix&lt;/h2&gt;	
	

	When the network problem is active, the nethod invoked by both riskyConnection and veryRiskyConnection &lt;b&gt;takes 15 seconds to copmlete&lt;/b&gt; - an unacceptable user experience.&lt;br&gt;
	One endpoint wraps this method with hystrix to limit the response time to 2 seconds, the other not.&lt;br&gt;

	Toggle Simulated Network/Service Problem @ &lt;a href="#" ng-click="toggleProblem()"&gt;/toggleProblem&lt;/a&gt;
		
	&lt;h3 ng-show="!problem"  style="color:green"&gt;Simulating Network Problem Inactive&lt;/h3&gt;
	
	&lt;h3 ng-show="problem"  style="color:red"&gt;Simulating Network Problem Active &lt;/h3&gt;

	Ping the service @ &lt;a href="#" ng-click="ping()"&gt;/ping&lt;/a&gt;&lt;br&gt;
	
	When the network problem is 
	Call Risky Connection &lt;b&gt;protected by Hystrix&lt;/b&gt; @ &lt;a href="#" ng-click="riskyConnection()"&gt;/riskyConnection&lt;/a&gt;&lt;br&gt;
	Call Risky Connection &lt;b&gt;unprotected by Hystrix&lt;/b&gt; @ &lt;a href="#" ng-click="veryRiskyConnection()"&gt;/veryRiskyConnection&lt;/a&gt;&lt;br&gt;

	&lt;h3 ng-show="responseData!=null"&gt;Response:&lt;/h3&gt;
	&lt;div style="color:green" ng-repeat="rd in responseData track by $index"&gt;{{rd|json}}&lt;/div&gt;
	&lt;p style="color:red" ng-show="errorMessage"&gt;{{errorMessage|json}}&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></code></pre>File: <b id='essentials/yaasbite900/src/main/webapp/WEB-INF/web.xml'/>essentials/yaasbite900/src/main/webapp/WEB-INF/web.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

    
&lt;/web-app&gt;
</pre></code></pre>File: <b id='essentials/yaasbite900/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbite900/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.*;

import java.time.Duration;
import java.time.Instant;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.TestRestTemplate;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpMethod;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;


@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")

public class SanityTest {

	private final String HOMEPAGE = "http://localhost:8080/";
	
	@Test(timeout = 10000) 
	public void siteIsAwakeAndWorking() throws Exception {				
		final TestRestTemplate restTemplate = new TestRestTemplate();
		HttpEntity<String> entity = new HttpEntity<String>( "{}" );
		
		String o = restTemplate.exchange(HOMEPAGE+"/ping", HttpMethod.GET, entity, String.class).getBody();
        assertTrue( o.equals("-> In GET /ping") );
    }

	@Test(timeout = 10000) 
	public void hystrixIsPreventingLongDelays() throws Exception {				
		final TestRestTemplate restTemplate = new TestRestTemplate();
		HttpEntity<String> entity = new HttpEntity<String>( "{}" );
		
		Instant t1 = Instant.now();
		restTemplate.exchange(HOMEPAGE+"/riskyConnection", HttpMethod.GET, entity, String.class).getBody();
		Instant t2 = Instant.now();
		long durationMS = Duration.between(t1, t2).toMillis(); 	
    	assertTrue( durationMS < TipService.GOOD_USER_EXPERIENCE_SLEEP_MS);
    	 	
		restTemplate.exchange(HOMEPAGE+"/toggleProblem", HttpMethod.GET, entity, String.class).getBody();
		
		t1 = Instant.now();
		restTemplate.exchange(HOMEPAGE+"/riskyConnection", HttpMethod.GET, entity, String.class).getBody();
        t2 = Instant.now();
    	durationMS = Duration.between(t1, t2).toMillis(); 	
    	assertTrue( durationMS < TipService.BAD_USER_EXPERIENCE_SLEEP_MS);
    }

}
</code></pre>File: <b id='essentials/yaasbitepubsub/pom.xml'/>essentials/yaasbitepubsub/pom.xml</b> <a href='#Top'>Top</a>
<pre class=prettyprint><code class='language-html'><pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.hybris.bites.yaas&lt;/groupId&gt;
	&lt;artifactId&gt;yaasbitepubsub&lt;/artifactId&gt;
	&lt;name&gt;yaasbitepubsub&lt;/name&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
        &lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;
			&lt;version&gt;1.1.0.RELEASE&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;
			&lt;artifactId&gt;javax.ws.rs-api&lt;/artifactId&gt;
			&lt;version&gt;2.0.1&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.googlecode.json-simple&lt;/groupId&gt;
			&lt;artifactId&gt;json-simple&lt;/artifactId&gt;
			&lt;version&gt;1.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Testing Dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;com.jayway.restassured&lt;/groupId&gt;
			&lt;artifactId&gt;spring-mock-mvc&lt;/artifactId&gt;
			&lt;version&gt;2.4.0&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;
			&lt;artifactId&gt;gson&lt;/artifactId&gt;
			&lt;version&gt;1.7.1&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
&lt;/project&gt;
</pre></code></pre>File: <b id='essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/Application.java'/>essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/Application.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>File: <b id='essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubClient.java'/>essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubClient.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.Map;
import java.util.Optional;

import javax.annotation.ManagedBean;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.PropertySource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

import com.google.gson.Gson;

/**
 * A class to provide simple access to the PubSub YaaS Service, via Java.
 * https://devportal.yaas.io/services/pubsub/latest/
 */
@ManagedBean
@PropertySource("classpath:application.properties")
@SuppressWarnings({ "rawtypes", "unchecked" })
public class PubSubClient {
	
	@Value("${pubsubURL}")
	private String pubsubURI;
	@Value("${oauthURL}")
	private String oauthURI;
	@Value("${yaaSClientsIdentifier}")
    private String yclientIdentifier;
	@Value("${yaaSClientsClient_ID}")
	private String clientId;
	@Value("${yaaSClientsClient_Secret}")
	private String clientSecret;
			
	private String token;
	private String endpoint;
	private String body;
	private Class expectedClass;

	public HttpStatus createTopic(String topic) {
		ResponseEntity<Map> response = 
			clean().
			endpoint(pubsubURI + "/topics").
			token(getOAuthToken()).
			body("{\"eventType\": \"" + topic + "\" }").
			expects(Map.class).
			post();
		return response.getStatusCode();
	}

	public HttpStatus deleteTopic(String topic) {
		ResponseEntity<String> response =
			clean().
			endpoint(pubsubURI + "/topics/" + yclientIdentifier + "/" + topic).
			token(getOAuthToken()).
			expects(String.class).
			delete();
		return response.getStatusCode();
	}

	public HttpStatus postMessage( String topic, String message) {
		ResponseEntity<String> response = 
			clean().
			endpoint(pubsubURI + "/topics/" + yclientIdentifier + "/" + topic + "/publish").
			body("{\"payload\": \"" + message + "\" }").
			token(getOAuthToken()).
			expects(String.class).
			post();
		return response.getStatusCode();
	}

	public Optional<PubSubJsonOutput> readMessage( String topic) {
		ResponseEntity<String> response = 
			clean().
			endpoint(pubsubURI + "/topics/" + yclientIdentifier + "/" + topic + "/read").
			token(getOAuthToken()).
			expects(String.class).
			post();

		if (response.getStatusCode() == HttpStatus.NO_CONTENT)
			return Optional.empty();
		Gson g = new Gson();
		PubSubJsonOutput o = g.fromJson(response.getBody(), PubSubJsonOutput.class);
		return Optional.of(o);
	}

	public HttpStatus commitMessage( String topic, String pubsubMessageId) {
		ResponseEntity<String> response = 
			clean().
			endpoint(pubsubURI + "/topics/" + yclientIdentifier + "/" + topic + "/commit").
			body("{\"token\": \"" + pubsubMessageId + "\" }").
			token(getOAuthToken()).
			expects(String.class).
			post();
		return response.getStatusCode();
	}

	private ResponseEntity post() {
		HttpEntity<Object> request = new HttpEntity<>(body, headerWithToken(token));
		ResponseEntity<Map<String,String>> response = new RestTemplate().exchange(endpoint, HttpMethod.POST, request, expectedClass);
		return response;
	}

	private ResponseEntity delete() {
		HttpEntity<Object> request = new HttpEntity<>(headerWithToken(token));
		ResponseEntity<String> response = new RestTemplate().exchange(endpoint, HttpMethod.DELETE, request, expectedClass);
		return response;
	}
	
	private PubSubClient token(String token) {
		this.token = token;
		return this;
	}

	private PubSubClient endpoint(String endpoint) {
		this.endpoint = endpoint;
		return this;
	}

	private PubSubClient body(String body) {
		this.body = body;
		return this;
	}

	private PubSubClient expects(Class c) {
		expectedClass = c;
		return this;
	}

	private PubSubClient clean() {
		token = "";
		endpoint = "";
		body = "";
		return this;
	}

	private HttpHeaders headerWithToken(String token) {
		HttpHeaders headers = new HttpHeaders();
		headers.add("content-type", "application/json");
		headers.add("Authorization", "Bearer " + token);
		return headers;
	}
   
	private String getOAuthToken(){   	
		HttpHeaders headers = new HttpHeaders();   	
		headers.add("content-type", "application/x-www-form-urlencoded" );  	
		String body = 
			"grant_type=client_credentials"+
			"&client_id="+clientId+
			"&client_secret="+clientSecret;
		HttpEntity<Object> request = new HttpEntity<>( body, headers );
		Map<String,String> tokenMap = new RestTemplate().postForObject(oauthURI, request, Map.class );  			
		return tokenMap.get("access_token");
    }	
}
</code></pre>File: <b id='essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubJsonOutput.java'/>essentials/yaasbitepubsub/src/main/java/com/hybris/yaas/bites/PubSubJsonOutput.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import java.util.HashMap;
import java.util.List;

/**
 * A Java Class to match the JSON response returned by the PubSub Service's endpoint: /topics /{topicOwnerClient}/{eventType} /read POST, as described in its raml file
 * https://devportal.yaas.io/services/pubsub/v1/api.raml 
 * and in a more readable format at https://devportal.yaas.io/services/pubsub/latest/apiconsole.html
 * 
 * The JSON example mentioned in the links above is the following:
 * {
    "events": [
        {
            "id": "067e6162-3b6f-4ae2-a171-2470b63dff00",
            "createdAt": 1078884319047,
            "tenant": "myExampleShop",
            "sourceClient": "order",
            "eventType": "order-created",
            "payload": "{ \"orderId\": \"123\" }"
        }
    ],
    "token": "someTokenValue"
}
 * Providing a matching Java class, PubSubJsonOutput, enables Jersey to automatically populate this class from JSON
 */

public class PubSubJsonOutput {
	private String token;
	private List<HashMap<String, String>> events;
	public List<HashMap<String, String>> getEvents() {
		return events;
	}
	public String getToken() {
		return token;
	}
}</code></pre>File: <b id='essentials/yaasbitepubsub/src/test/java/com/hybris/yaas/bites/SanityTest.java'/>essentials/yaasbitepubsub/src/test/java/com/hybris/yaas/bites/SanityTest.java</b> <a href='#Top'>Top</a> <a target='blank' href='https://github.com/SAP/yaas-getting-started-yaasbites'>@Github</a>
<pre class=prettyprint><code class='language-java '>package com.hybris.yaas.bites;

import static org.junit.Assert.*;

import java.util.Optional;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.test.SpringApplicationConfiguration;
import org.springframework.boot.test.WebIntegrationTest;
import org.springframework.context.annotation.PropertySource;
import org.springframework.http.HttpStatus;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(Application.class)
@WebIntegrationTest("server.port=8080")
@PropertySource("classpath:application.properties")

public class SanityTest {
	@Autowired
    private PubSubClient psc;
	
	@Value("${yaaSClientsIdentifier}")
	private String clientIdentifier;
	
	@Value("${topic}")
	private String pubsubTopic;
	
	private String businessEvent1 = "{'Tip':'Do not eat fireworks', 'AuthorsEmail': 'bob.builder@sap.com'}";
	private String businessEvent2 = "{'Tip':'Do not eat haggis', 'AuthorsEmail': 'bob.builder@sap.com'}";
	int msSleepTime = 500;

	@Test
    public void pubsubHappyPath() throws Exception {		
		HttpStatus httpStatusForCreateTopic = psc.createTopic( pubsubTopic );
		assertEquals( HttpStatus.CREATED, httpStatusForCreateTopic );
		Thread.sleep(msSleepTime);

		HttpStatus httpStatusForPostMessage1 = psc.postMessage(  pubsubTopic, businessEvent1);
		assertEquals( HttpStatus.CREATED,  httpStatusForPostMessage1 );
		Thread.sleep(msSleepTime);
		
		HttpStatus httpStatusForPostMessage2 = psc.postMessage(  pubsubTopic, businessEvent2);
		assertEquals( HttpStatus.CREATED,  httpStatusForPostMessage2 );
		Thread.sleep(msSleepTime);
		
		Optional<PubSubJsonOutput> pubsubJsonOutput1 = psc.readMessage(  pubsubTopic);			
		assertEquals( pubsubJsonOutput1.get().getEvents().get(0).get("payload"), businessEvent1);
		Thread.sleep(msSleepTime);
		
		HttpStatus httpStatusForCommitMessage1 = psc.commitMessage(  pubsubTopic, pubsubJsonOutput1.get().getToken() );
		assertEquals( HttpStatus.OK, httpStatusForCommitMessage1 );
		Thread.sleep(msSleepTime);

		Optional<PubSubJsonOutput> pubsubJsonOutput2 = psc.readMessage(  pubsubTopic);			
		assertEquals( pubsubJsonOutput2.get().getEvents().get(0).get("payload"), businessEvent2);
		Thread.sleep(msSleepTime);
		
		HttpStatus httpStatusForCommitMessage2 = psc.commitMessage(  pubsubTopic, pubsubJsonOutput2.get().getToken() );
		assertEquals( HttpStatus.OK, httpStatusForCommitMessage2 );
		Thread.sleep(msSleepTime);

		HttpStatus httpStatusForDeleteMessage = psc.deleteTopic(  pubsubTopic );
		assertEquals( HttpStatus.ACCEPTED, httpStatusForDeleteMessage );
    }
}
</code></pre></body></html>